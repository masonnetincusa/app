<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Flappy Bird â€“ Public Accounts & Admin Console</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- Retro Press Start 2P Font -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
        rel="stylesheet" />

  <style>
    html, body {
      margin:0; padding:0;
      width:100vw; height:100vh;
      background:#000; overflow:hidden;
      font-family: Arial, sans-serif;
    }

    /* Game background */
    #background {
      position:absolute; top:0; left:0;
      width:100%; height:100%;
      background: url('https://app.masonnet.org/lightbg.png') center/cover no-repeat;
      z-index:0; display:none;
    }

    canvas {
      position:absolute; top:0; left:0;
      width:100%; height:100%;
      z-index:1; touch-action:none;
    }

    #score {
      position:absolute; top:10px; left:10px;
      font-family:'Press Start 2P',system-ui;
      font-size:48px; color:#fff;
      text-shadow:2px 2px 4px rgba(0,0,0,0.7);
      z-index:2;
    }

    #pauseBtn {
      position:absolute; top:10px; right:10px;
      display:none; z-index:2;
      background:#f00; color:#fff; border:none;
      padding:8px 16px; font-size:16px; cursor:pointer;
    }

    /* PROFILE CARD */
    #profileCard {
      position:absolute; top:10px; right:10px;
      width:64px; height:64px;
      background:rgba(0,0,0,0.7);
      border:2px solid #f00; border-radius:8px;
      overflow:hidden; cursor:pointer; z-index:4;
      transition: width .2s ease-in-out, height .2s ease-in-out;
    }
    #profileCard.expanded {
      width:280px;
      height:auto;
    }

    /* collapsed (avatar only) */
    #pc-collapsed {
      width:100%; height:100%;
      display:flex; align-items:center; justify-content:center;
    }
    #pc-collapsed img {
      width:56px; height:56px; border-radius:50%;
    }

    /* expanded options */
    #pc-options {
      display:none;
      flex-direction:column;
      background:rgba(0,0,0,0.8);
      padding:12px;
    }
    #profileCard.expanded #pc-options {
      display:flex;
    }

    /* Info row: avatar + username + badges */
    .pc-info {
      display:flex; align-items:center;
      margin-bottom:12px;
    }
    .pc-info img {
      width:48px; height:48px; border-radius:50%;
      margin-right:8px;
    }
    .pc-info .username {
      font-size:16px; font-weight:bold;
      color:#fff;
    }
    .pc-info .badges {
      margin-left:auto;
    }

    /* option elements */
    #pc-options input,
    #pc-options button {
      width:100%;
      margin:6px 0;
      font-size:14px;
      border:none; border-radius:4px;
    }
    #pc-options input {
      padding:6px 8px;
    }
    #pc-options button {
      padding:8px 0;
      background:#f00; color:#fff;
      cursor:pointer;
    }

    /* STANDARD OVERLAYS */
    .overlay {
      position:absolute; top:0; left:0;
      width:100%; height:100%;
      background:rgba(0,0,0,0.85);
      display:flex; align-items:center; justify-content:center;
      z-index:3;
    }
    .hidden { display:none; }

    .overlay-content {
      text-align:center; color:#fff;
      max-width:320px; width:100%;
    }
    .overlay-content h2 {
      margin:0 0 16px; font-size:32px;
    }
    .overlay-content button {
      background:#f00; color:#fff; border:none;
      padding:12px 24px; font-size:18px;
      margin:8px 0; width:200px; cursor:pointer;
    }
    .overlay-content input,
    .overlay-content textarea {
      width:100%; padding:8px; margin:8px 0;
      font-size:16px; border:none; border-radius:4px;
    }
    .overlay-content textarea { min-height:80px; }
    .overlay-content label {
      display:flex; align-items:center;
      margin:8px 0; justify-content:center;
    }
    .overlay-content label input { margin-right:8px; }
    .scroll-list {
      background:#111; padding:12px; margin:16px 0;
      max-height:200px; overflow-y:auto; text-align:left;
      color:#fff; border-radius:4px;
    }
    .scroll-list div {
      border-bottom:1px solid #333; padding:6px 0;
    }

    /* ADMIN TABS */
    .admin-tabs { display:flex; margin-bottom:12px; }
    .admin-tabs button {
      flex:1; margin:0 4px; padding:8px;
      background:#222; color:#fff; border:none;
      cursor:pointer; font-size:14px;
    }
    .admin-tab-content { display:none; }
    .admin-tab-content.active { display:block; }

    /* BADGE ICONS */
    .badge-icon {
      width:16px; height:16px;
      vertical-align:middle; margin-left:4px;
    }
  </style>
</head>
<body>

  <div id="background"></div>
  <canvas id="canvas"></canvas>
  <div id="score">0</div>
  <button id="pauseBtn">Pause</button>

  <!-- PROFILE CARD -->
  <div id="profileCard">
    <div id="pc-collapsed">
      <img id="pc-avatar" src="https://app.masonnet.org/default-avatar.png" alt="Avatar"/>
    </div>
    <div id="pc-options">
      <div class="pc-info">
        <img id="pc-info-avatar" src="https://app.masonnet.org/default-avatar.png" alt="Avatar"/>
        <span id="pc-username" class="username">User</span>
        <span id="pc-badges" class="badges"></span>
      </div>
      <button id="pc-feedbackBtn">Submit Feedback</button>
      <button id="pc-searchBtn">Search Profilesâ€¦</button>
      <button id="pc-accountBtn">Account Settings</button>
      <button id="pc-authBtn">Sign In</button>
    </div>
  </div>

  <!-- LOGIN OVERLAY -->
  <div id="loginOverlay" class="overlay hidden">
    <div class="overlay-content">
      <h2>Sign In / Sign Up</h2>
      <input id="loginEmail" type="email" placeholder="Email" />
      <input id="loginPass" type="password" placeholder="Password" />
      <label><input id="loginRemember" type="checkbox"/> Remember me</label>
      <button id="loginSubmit">Submit</button>
      <button id="loginCancel">Cancel</button>
    </div>
  </div>

  <!-- MAIN MENU OVERLAY -->
  <div id="menuOverlay" class="overlay">
    <div class="overlay-content">
      <img src="https://app.masonnet.org/fbrc.png" alt="Logo" style="max-width:180px;"/>
      <h2>Main Menu</h2>
      <button id="startBtn">Start</button>
      <button id="leaderboardBtn">Leaderboard</button>
      <button id="settingsBtn">Settings</button>
      <button id="hubBtn">Flappy Bird Hub</button>
    </div>
  </div>

  <!-- ACCOUNT SETTINGS OVERLAY -->
  <div id="accountOverlay" class="overlay hidden">
    <div class="overlay-content">
      <h2>Account Settings</h2>
      <img id="as-avatar" src="https://app.masonnet.org/default-avatar.png"
           alt="Avatar" style="width:64px;height:64px;border-radius:50%;"/>
      <div>Username: <span id="as-username"></span></div>
      <h3>Your Score History</h3>
      <div id="as-scoreHistory" class="scroll-list"></div>
      <button id="as-closeBtn">Close</button>
    </div>
  </div>

  <!-- PROFILE PAGE OVERLAY -->
  <div id="profileOverlay" class="overlay hidden">
    <div class="overlay-content">
      <h2>Profile</h2>
      <img id="pf-avatar" src="https://app.masonnet.org/default-avatar.png"
           alt="Avatar" style="width:64px;height:64px;border-radius:50%;"/>
      <div>
        <strong id="pf-username"></strong><span id="pf-exclBadges"></span>
      </div>
      <div id="pf-name"></div>
      <div>High Score: <span id="pf-highscore"></span></div>
      <div>Rank: <span id="pf-rank"></span></div>
      <div id="pf-badges"></div>
      <div id="pf-ownerExtras" class="hidden">
        <h3>Your History</h3>
        <div id="pf-history" class="scroll-list"></div>
      </div>
      <button id="pf-closeBtn">Close</button>
    </div>
  </div>

  <!-- FEEDBACK OVERLAY -->
  <div id="feedbackOverlay" class="overlay hidden">
    <div class="overlay-content">
      <h2>Submit Feedback</h2>
      <label><input type="radio" name="fbType" value="feature" checked/> Feature Request</label>
      <label><input type="radio" name="fbType" value="general"/> General Feedback</label>
      <label><input type="radio" name="fbType" value="bug"/> Bug Report</label>
      <input id="fbSubject" placeholder="Subject" />
      <textarea id="fbDetails" placeholder="Describe your feedback..."></textarea>
      <button id="fbSubmit">Submit</button>
      <button id="fbCancel">Cancel</button>
    </div>
  </div>

  <!-- SETTINGS OVERLAY -->
  <div id="settingsOverlay" class="overlay hidden">
    <div class="overlay-content">
      <h2>Settings</h2>
      <button id="soundToggle">ðŸ”Š Sound</button>
      <button id="themeToggle">ðŸŒ™ Dark Mode</button>
      <button id="skipToggle">ðŸš€ Skip to GO: Off</button>
      <button id="settingsCloseBtn">Close</button>
    </div>
  </div>

  <!-- LEADERBOARD OVERLAY -->
  <div id="leaderboardOverlay" class="overlay hidden">
    <div class="overlay-content">
      <h2>Global Top 10</h2>
      <div id="leaderboardList" class="scroll-list"></div>
      <button id="lbCloseBtn">Back</button>
    </div>
  </div>

  <!-- ADMIN OVERLAY -->
  <div id="adminOverlay" class="overlay hidden">
    <div class="overlay-content">
      <h2>Admin Console</h2>
      <div class="admin-tabs">
        <button id="tabHomeBtn">Home</button>
        <button id="tabFeedbackBtn">Feedback</button>
        <button id="tabModerationBtn">Moderation</button>
        <button id="tabOtherBtn">Other</button>
      </div>
      <div id="adminHome" class="admin-tab-content active">
        <p>Welcome, Admin!</p>
      </div>
      <div id="adminFeedback" class="admin-tab-content">
        <h3>Feedback Submissions</h3>
        <div id="adminFeedbackList" class="scroll-list"></div>
      </div>
      <div id="adminModeration" class="admin-tab-content">
        <h3>User Moderation</h3>
        <input id="modSearch" placeholder="Search userâ€¦" />
        <button id="modSearchBtn">Find</button>
        <div id="modUserInfo" class="scroll-list"></div>
      </div>
      <div id="adminOther" class="admin-tab-content">
        <p>Other tools coming soonâ€¦</p>
      </div>
      <button id="adminCloseBtn">Close</button>
    </div>
  </div>

  <!-- PAUSE OVERLAY -->
  <div id="pauseOverlay" class="overlay hidden">
    <div class="overlay-content">
      <h2>Paused</h2>
      <button id="resumeBtn">Resume</button>
      <button id="pauseMenuBtn">Main Menu</button>
    </div>
  </div>

  <!-- GAME OVER OVERLAY -->
  <div id="gameoverOverlay" class="overlay hidden">
    <div class="overlay-content">
      <h2>Game Over</h2>
      <p>Your Score: <span id="finalScore">0</span></p>
      <button id="restartBtn">Restart</button>
      <button id="goMenuBtn">Main Menu</button>
    </div>
  </div>

  <!-- NAME PROMPT OVERLAY -->
  <div id="nameOverlay" class="overlay hidden">
    <div class="overlay-content">
      <h2>ðŸŽ‰ New High Score!</h2>
      <p>Score: <span id="newScore"></span></p>
      <input id="nameInput" placeholder="Enter your name" />
      <button id="saveNameBtn">Save</button>
      <button id="skipNameBtn">Skip</button>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-database-compat.js"></script>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // Constants & Firebase init
    const OBSTACLE_WIDTH=60, PIPE_GAP_MIN=120, PIPE_GAP_MAX=200, FLAP_CD=200;
    firebase.initializeApp({
      apiKey:    "AIzaSyDtfrpxKaROrq1D0NUAbFl0Z9E7axOIxE",
      authDomain:"masonnet-app-official.firebaseapp.com",
      databaseURL:"https://masonnet-app-official-default-rtdb.firebaseio.com",
      projectId:"masonnet-app-official"
    });
    const auth = firebase.auth(),
          db   = firebase.database(),
          lbRef = db.ref("leaderboard"),
          fbRef = db.ref("feedback"),
          profilesRef = db.ref("profiles"),
          roles = db.ref("roles");

    // Helpers
    const $ = id => document.getElementById(id);
    function elt(tag, cls){const e=document.createElement(tag); if(cls) e.className=cls; return e;}

    // DOM refs
    const profileCard    = $('profileCard'),
          pcCollapsed    = $('pc-collapsed'),
          pcOptions      = $('pc-options'),
          pcAvatar       = $('pc-avatar'),
          pcInfoAvatar   = $('pc-info-avatar'),
          pcUsername     = $('pc-username'),
          pcBadges       = $('pc-badges'),
          pcSearchBtn    = $('pc-searchBtn'),
          pcFeedbackBtn  = $('pc-feedbackBtn'),
          pcAccountBtn   = $('pc-accountBtn'),
          pcAuthBtn      = $('pc-authBtn'),
          startBtn       = $('startBtn'),
          leaderboardBtn = $('leaderboardBtn'),
          settingsBtn    = $('settingsBtn');

    const loginOverlay   = $('loginOverlay'),
          menuOverlay    = $('menuOverlay'),
          accountOverlay = $('accountOverlay'),
          profileOverlay = $('profileOverlay'),
          feedbackOverlay= $('feedbackOverlay'),
          settingsOverlay= $('settingsOverlay'),
          leaderboardOverlay=$('leaderboardOverlay'),
          adminOverlay   = $('adminOverlay'),
          pauseOverlay   = $('pauseOverlay'),
          gameoverOverlay=$('gameoverOverlay'),
          nameOverlay    = $('nameOverlay');

    // Responsive canvas
    window.addEventListener('resize', ()=>{
      $('canvas').width = innerWidth;
      $('canvas').height= innerHeight;
    });
    $('canvas').width = innerWidth;
    $('canvas').height= innerHeight;

    // Show/hide overlays
    function showOverlay(el){
      [
        loginOverlay, menuOverlay, accountOverlay, profileOverlay,
        feedbackOverlay, settingsOverlay, leaderboardOverlay,
        adminOverlay, pauseOverlay, gameoverOverlay, nameOverlay
      ].forEach(o=>o.classList.add('hidden'));
      if(el) el.classList.remove('hidden');
      // collapse profile card
      profileCard.classList.remove('expanded');
    }

    // render username + exclusive badges
    function renderUserSpan(name, excl=[]){
      const span = elt('span');
      span.textContent = name;
      excl.forEach(id=>{
        const img = elt('img','badge-icon');
        img.src = badgeIcons[id];
        span.appendChild(img);
      });
      return span;
    }

    // Toggle profile card
    profileCard.addEventListener</h2>
      <button id="resumeBtn">Resume</button>
      <button id="pauseMenuBtn">Main Menu</button>
    </div>
  </div>

  <!-- GAME OVER OVERLAY -->
  <div id="gameoverOverlay" class="overlay hidden">
    <div class="overlay-content">
      <h2>Game Over</h2>
      <p>Your Score: <span id="finalScore">0</span></p>
      <button id="restartBtn">Restart</button>
      <button id="goMenuBtn">Main Menu</button>
    </div>
  </div>

  <!-- NAME PROMPT OVERLAY -->
  <div id="nameOverlay" class="overlay hidden">
    <div class="overlay-content">
      <h2>ðŸŽ‰ New High Score!</h2>
      <p>Score: <span id="newScore"></span></p>
      <input id="nameInput" placeholder="Enter your name" />
      <button id="saveNameBtn">Save</button>
      <button id="skipNameBtn">Skip</button>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-database-compat.js"></script>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // Constants & Firebase init
    const OBSTACLE_WIDTH=60, PIPE_GAP_MIN=120, PIPE_GAP_MAX=200, FLAP_CD=200;
    firebase.initializeApp({
      apiKey:    "AIzaSyDtfrpxKaROrq1D0NUAbFl0Z9E7axOIxE",
      authDomain:"masonnet-app-official.firebaseapp.com",
      databaseURL:"https://masonnet-app-official-default-rtdb.firebaseio.com",
      projectId:"masonnet-app-official"
    });
    const auth = firebase.auth(),
          db   = firebase.database(),
          lbRef = db.ref("leaderboard"),
          fbRef = db.ref("feedback"),
          profilesRef = db.ref("profiles"),
          roles = db.ref("roles");

    // Helpers
    const $ = id => document.getElementById(id);
    function elt(tag, cls){const e=document.createElement(tag); if(cls) e.className=cls; return e;}

    // DOM refs
    const profileCard    = $('profileCard'),
          pcCollapsed    = $('pc-collapsed'),
          pcOptions      = $('pc-options'),
          pcAvatar       = $('pc-avatar'),
          pcInfoAvatar   = $('pc-info-avatar'),
          pcUsername     = $('pc-username'),
          pcBadges       = $('pc-badges'),
          pcSearchBtn    = $('pc-searchBtn'),
          pcFeedbackBtn  = $('pc-feedbackBtn'),
          pcAccountBtn   = $('pc-accountBtn'),
          pcAuthBtn      = $('pc-authBtn'),
          startBtn       = $('startBtn'),
          leaderboardBtn = $('leaderboardBtn'),
          settingsBtn    = $('settingsBtn');

    const loginOverlay   = $('loginOverlay'),
          menuOverlay    = $('menuOverlay'),
          accountOverlay = $('accountOverlay'),
          profileOverlay = $('profileOverlay'),
          feedbackOverlay= $('feedbackOverlay'),
          settingsOverlay= $('settingsOverlay'),
          leaderboardOverlay=$('leaderboardOverlay'),
          adminOverlay   = $('adminOverlay'),
          pauseOverlay   = $('pauseOverlay'),
          gameoverOverlay=$('gameoverOverlay'),
          nameOverlay    = $('nameOverlay');

    // Responsive canvas
    window.addEventListener('resize', ()=>{
      $('canvas').width = innerWidth;
      $('canvas').height= innerHeight;
    });
    $('canvas').width = innerWidth;
    $('canvas').height= innerHeight;

    // Show/hide overlays
    function showOverlay(el){
      [
        loginOverlay, menuOverlay, accountOverlay, profileOverlay,
        feedbackOverlay, settingsOverlay, leaderboardOverlay,
        adminOverlay, pauseOverlay, gameoverOverlay, nameOverlay
      ].forEach(o=>o.classList.add('hidden'));
      if(el) el.classList.remove('hidden');
      // collapse profile card
      profileCard.classList.remove('expanded');
    }

    // render username + exclusive badges
    function renderUserSpan(name, excl=[]){
      const span = elt('span');
      span.textContent = name;
      excl.forEach(id=>{
        const img = elt('img','badge-icon');
        img.src = badgeIcons[id];
        span.appendChild(img);
      });
      return span;
    }

    // Toggle profile card
    profileCard.addEventListener('click', e=>{
      e.stopPropagation();
      profileCard.classList.toggle('expanded');
    });
    document.body.addEventListener('click', ()=>{
      profileCard.classList.remove('expanded');
    });

    // Auth state changes
    auth.onAuthStateChanged(user=>{
      if(user){
        // load profile
        profilesRef.child(user.uid).once('value', snap=>{
          const p = snap.val()||{};
          pcAvatar.src = p.avatarUrl || pcAvatar.src;
          pcInfoAvatar.src = pcAvatar.src;
          const uname = p.username || user.displayName || user.email;
          pcUsername.innerHTML = '';
          pcUsername.appendChild(renderUserSpan(uname, p.badges?.exclusive));
          // standard badges
          pcBadges.innerHTML = '';
          (p.badges?.standard||[]).forEach(id=>{
            const img=elt('img','badge-icon');
            img.src = badgeIcons[id];
            pcBadges.appendChild(img);
          });
          // show options
          pcFeedbackBtn.style.display = 'block';
          pcAccountBtn.style.display  = 'block';
          pcAuthBtn.textContent        = 'Sign Out';
        });
      } else {
        pcAvatar.src = 'https://app.masonnet.org/default-avatar.png';
        pcInfoAvatar.src = pcAvatar.src;
        pcUsername.textContent = '';
        pcBadges.innerHTML = '';
        pcFeedbackBtn.style.display = 'none';
        pcAccountBtn.style.display  = 'none';
        pcAuthBtn.textContent        = 'Sign In';
      }
      showOverlay(menuOverlay);
    });

    // ProfileCard option handlers
    pcFeedbackBtn.onclick = ()=> showOverlay(feedbackOverlay);
    pcAccountBtn.onclick  = ()=> showOverlay(accountOverlay);
    pcSearchBtn.onclick   = () =>{
      const q = $('pc-search').value.trim();
      if(q) performSearch(q);
    };
    pcAuthBtn.onclick     = ()=>{
      if(auth.currentUser) auth.signOut();
      else showOverlay(loginOverlay);
    };

    // Collapse on navigation
    startBtn.onclick       = ()=> showOverlay(null);
    leaderboardBtn.onclick = ()=> showOverlay(leaderboardOverlay);
    settingsBtn.onclick    = ()=> showOverlay(settingsOverlay);

    // performSearch & openProfile (stubbed)
    function performSearch(q){
      profilesRef.orderByChild('username')
        .startAt(q).endAt(q+"\uf8ff")
        .limitToFirst(1)
        .once('value', snap=>{
          const data = snap.val(), uid = data?Object.keys(data)[0]:null;
          if(uid) openProfile(uid);
          else alert("No user found");
        });
    }
    function openProfile(uid){
      // load and populate profileOverlay...
      showOverlay(profileOverlay);
    }

    // Feedback submission
    const fbTypeEls = document.getElementsByName('fbType');
    const fbSubject = $('fbSubject');
    const fbDetails = $('fbDetails');
    $('fbSubmit').onclick = ()=>{
      const user = auth.currentUser;
      if(!user) return alert("Sign in first");
      const type = [...fbTypeEls].find(e=>e.checked).value;
      fbRef.push({
        uid: user.uid,
        type,
        subject: fbSubject.value.trim(),
        message: fbDetails.value.trim(),
        timestamp: Date.now()
      });
      alert("Thanks for your feedback!");
      showOverlay(menuOverlay);
    };
    $('fbCancel').onclick = ()=> showOverlay(menuOverlay);

    // ... rest of your game logic, leaderboard, admin console, moderation, score handling etc. ...

    // Initialize
    showOverlay(menuOverlay);
  });
  </script>
</body>
</html>
