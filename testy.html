<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Game with Branded Menu + Firebase</title>
  <style>
    /* Reset & Base */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: sans-serif; overflow: hidden; }

    /* Dark mode */
    body.dark-mode { background: #222; color: #eee; }
    body.dark-mode canvas { background: #000; }

    /* Header & Navigation */
    #main-header {
      position: absolute;
      top: 0; left: 0; width: 100%;
      display: flex; align-items: center; justify-content: space-between;
      padding: 8px 16px;
      background: rgba(255,255,255,0.9);
      z-index: 1000;
    }
    body.dark-mode #main-header {
      background: rgba(0,0,0,0.8);
    }

    /* Title Image */
    #title-img {
      max-height: 60px;
      width: auto;
    }

    /* Nav Buttons */
    .nav-btn {
      background: #e03a3e; /* Branded red */
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      padding: 12px 24px;
      margin-left: 8px;
      cursor: pointer;
      min-height: 44px;
      max-width: 180px;
      white-space: nowrap;
    }
    .nav-btn:hover { opacity: 0.9; }

    /* Profile Card */
    #profile-card {
      display: none;
      align-items: center;
      margin-left: 16px;
    }
    #profile-card img {
      width: 32px; height: 32px;
      border-radius: 50%;
      margin-right: 8px;
    }
    #profile-card button {
      margin-left: 8px;
      background: transparent;
      color: inherit;
      border: 1px solid currentColor;
      border-radius: 4px;
      padding: 4px 8px;
      cursor: pointer;
    }

    /* Canvas */
    #game-canvas {
      display: block;
      background: #ddd;
      width: 100vw;
      height: 100vh;
    }

    /* Settings Overlay */
    .overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex; align-items: center; justify-content: center;
      z-index: 1001;
    }
    .overlay.hidden { display: none; }
    #settings-panel {
      background: #fff;
      padding: 24px;
      border-radius: 8px;
      width: 300px;
    }
    #settings-panel label {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
    }
    #settings-panel input[type="checkbox"] {
      margin-right: 8px;
    }
    #close-settings {
      margin-top: 16px;
      background: #e03a3e;
      color: #fff;
      border: none;
      padding: 8px 16px;
      cursor: pointer;
      border-radius: 4px;
    }
  </style>
</head>

<body>
  <!-- Header with Title, Nav, Profile -->
  <header id="main-header">
    <img id="title-img" src="https://app.masonnet.org/fbrc.png" alt="Game Title" />

    <div>
      <button class="nav-btn" id="start-btn">Start Game</button>
      <button class="nav-btn" id="settings-btn">Settings</button>
    </div>

    <div id="profile-card">
      <img id="avatar" src="" alt="Avatar" />
      <span id="display-name"></span>
      <button id="logout-btn">Logout</button>
    </div>
  </header>

  <!-- Game Canvas -->
  <canvas id="game-canvas"></canvas>

  <!-- Settings Overlay -->
  <div id="settings-overlay" class="overlay hidden">
    <div id="settings-panel">
      <h2>Settings</h2>
      <label><input type="checkbox" id="toggle-sound" checked /> Sound</label>
      <label><input type="checkbox" id="toggle-dark" /> Dark Mode</label>
      <label><input type="checkbox" id="toggle-skip" /> Skip to Game Over</label>
      <button id="close-settings">Close</button>
    </div>
  </div>

  <!-- Firebase App & Auth -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

  <script>
    // Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDtfrpxKaROrq1D0NUAbFl0FZ9E7axOIxE",
      authDomain: "masonnet-app-official.firebaseapp.com",
      databaseURL: "https://masonnet-app-official-default-rtdb.firebaseio.com",
      projectId: "masonnet-app-official",
      storageBucket: "masonnet-app-official.firebasestorage.app",
      messagingSenderId: "783919367562",
      appId: "1:783919367562:web:b7bb809332a4e873f3b473",
      measurementId: "G-X1YKV5VK7J"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // DOM Elements
    const profileCard = document.getElementById('profile-card');
    const avatarImg   = document.getElementById('avatar');
    const displayName = document.getElementById('display-name');
    const logoutBtn   = document.getElementById('logout-btn');
    const startBtn    = document.getElementById('start-btn');
    const settingsBtn = document.getElementById('settings-btn');
    const settingsOv  = document.getElementById('settings-overlay');
    const closeSetBtn = document.getElementById('close-settings');
    const darkToggle  = document.getElementById('toggle-dark');
    const skipToggle  = document.getElementById('toggle-skip');

    let gameRunning = false;

    // Auth state listener
    auth.onAuthStateChanged(user => {
      if (user) {
        avatarImg.src          = user.photoURL || 'https://app.masonnet.org/default-avatar.png';
        displayName.textContent = user.displayName || 'Player';
        profileCard.style.display = 'flex';
      } else {
        profileCard.style.display = 'none';
      }
    });

    // Logout
    logoutBtn.addEventListener('click', () => auth.signOut());

    // Settings overlay controls
    settingsBtn.addEventListener('click', () => {
      if (!gameRunning) settingsOv.classList.remove('hidden');
    });
    closeSetBtn.addEventListener('click', () => settingsOv.classList.add('hidden'));

    darkToggle.addEventListener('change', () => {
      document.body.classList.toggle('dark-mode', darkToggle.checked);
    });

    // Start Game
    startBtn.addEventListener('click', () => {
      gameRunning = true;
      document.getElementById('main-header').style.display = 'none';
      settingsOv.classList.add('hidden');
      startGame();
    });

    // Minimal Canvas Game Loop
    const canvas = document.getElementById('game-canvas');
    const ctx    = canvas.getContext('2d');
    resizeCanvas();

    let x = canvas.width / 2;
    let y = canvas.height / 2;
    let dx = 2, dy = 1.5;

    function startGame() {
      function loop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // Simple bouncing ball
        ctx.beginPath();
        ctx.arc(x, y, 20, 0, Math.PI * 2);
        ctx.fillStyle = '#e03a3e';
        ctx.fill();

        x += dx; y += dy;
        if (x < 20 || x > canvas.width - 20) dx *= -1;
        if (y < 20 || y > canvas.height - 20) dy *= -1;

        // Skip-to-game-over example
        if (skipToggle.checked && x > canvas.width - 40) {
          cancelAnimationFrame(frameId);
          gameOver();
          return;
        }

        frameId = requestAnimationFrame(loop);
      }
      let frameId = requestAnimationFrame(loop);
    }

    function gameOver() {
      ctx.fillStyle = 'rgba(0,0,0,0.6)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#fff';
      ctx.font = '48px sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('Game Over', canvas.width / 2, canvas.height / 2);
      setTimeout(() => location.reload(), 2000);
    }

    // Resize handling
    window.addEventListener('resize', resizeCanvas);
    function resizeCanvas() {
      canvas.width  = window.innerWidth;
      canvas.height = window.innerHeight;
    }
  </script>
</body>
</html>
