<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flappy Bird Hub</title>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <style>
    /* Layer container */
    #layer-container { position: relative; width: 100%; height: 100vh; overflow: hidden; }

    /* Game canvas hidden until play */
    #game-canvas { display: none; position: absolute; top: 0; left: 0; z-index: 1; background: #70c5ce; }

    /* UI layer sits above canvas */
    #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none; }

    /* Profile card */
    #profile-card {
      position: fixed; top: 16px; right: 16px;
      background: rgba(255,255,255,0.9); padding: 8px 12px; border-radius: 8px;
      display: flex; align-items: center; gap: 8px; pointer-events: auto; z-index: 10;
    }
    #profile-card img { width: 32px; height: 32px; border-radius: 50%; }
    #profile-card button { font-size: 0.9rem; }

    /* Overlays */
    .overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6); color: #fff;
      display: none; flex-direction: column; justify-content: center;
      align-items: center; gap: 12px; pointer-events: auto; text-align: center;
    }
    .overlay.visible { display: flex; }
    .overlay h1, .overlay h2 { margin: 0; font-weight: normal; }
    .overlay button { padding: 8px 16px; font-size: 1rem; cursor: pointer; }
  </style>
</head>
<body>
  <div id="layer-container">
    <canvas id="game-canvas" width="400" height="600"></canvas>

    <div id="ui-layer">
      <!-- Profile Card -->
      <div id="profile-card">
        <img id="user-photo" src="https://app.masonnet.org/default-avatar.png" alt="User Photo"/>
        <span id="user-name">Guest</span>
        <button id="sign-in-btn">Sign In</button>
        <button id="sign-out-btn" style="display:none;">Sign Out</button>
      </div>

      <!-- Main Menu -->
      <div id="main-menu" class="overlay visible">
        <h1>Flappy Bird Hub</h1>
        <button id="start-btn" disabled>Start Game</button>
        <button id="show-leaderboard-btn">Leaderboard</button>
      </div>

      <!-- Game Over -->
      <div id="game-over" class="overlay">
        <h2>Game Over</h2>
        <p>Your Score: <span id="final-score">0</span></p>
        <button id="play-again-btn">Play Again</button>
      </div>

      <!-- Leaderboard -->
      <div id="leaderboard-modal" class="overlay">
        <h2>Top 10 Scores</h2>
        <ol id="leaderboard-list"></ol>
        <button id="close-leaderboard-btn">Close</button>
      </div>
    </div>
  </div>

  <script>
    // 1. Firebase init (replace with your config)
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyDtfrpxKaROrq1D0NUAbFl0FZ9E7axOIxE",
  authDomain: "masonnet-app-official.firebaseapp.com",
  databaseURL: "https://masonnet-app-official-default-rtdb.firebaseio.com",
  projectId: "masonnet-app-official",
  storageBucket: "masonnet-app-official.firebasestorage.app",
  messagingSenderId: "783919367562",
  appId: "1:783919367562:web:b7bb809332a4e873f3b473",
  measurementId: "G-X1YKV5VK7J"
};
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db   = firebase.database();
    const provider = new firebase.auth.GoogleAuthProvider();

    // 2. UI refs
    const canvas      = document.getElementById('game-canvas');
    const ctx         = canvas.getContext('2d');
    const profileCard = document.getElementById('profile-card');
    const userName    = document.getElementById('user-name');
    const userPhoto   = document.getElementById('user-photo');
    const signInBtn   = document.getElementById('sign-in-btn');
    const signOutBtn  = document.getElementById('sign-out-btn');

    const mainMenu    = document.getElementById('main-menu');
    const startBtn    = document.getElementById('start-btn');
    const gameOver    = document.getElementById('game-over');
    const finalScore  = document.getElementById('final-score');
    const playAgain   = document.getElementById('play-again-btn');

    const lbModal     = document.getElementById('leaderboard-modal');
    const lbList      = document.getElementById('leaderboard-list');
    const showLbBtn   = document.getElementById('show-leaderboard-btn');
    const closeLbBtn  = document.getElementById('close-leaderboard-btn');

    // 3. Sounds
    const flapSound = new Audio('https://app.masonnet.org/flap.mp3');
    const pointSound = new Audio('https://app.masonnet.org/point.mp3');
    const hitSound = new Audio('https://app.masonnet.org/hit.mp3');
    const dieSound = new Audio('https://app.masonnet.org/die.mp3');

    // 4. Auth state
    auth.onAuthStateChanged(user => {
      if (user) {
        userName.textContent = user.displayName;
        userPhoto.src        = user.photoURL;
        signInBtn.style.display  = 'none';
        signOutBtn.style.display = 'inline-block';
        startBtn.disabled        = false;
      } else {
        userName.textContent = 'Guest';
        userPhoto.src        = 'https://app.masonnet.org/default-avatar.png';
        signInBtn.style.display  = 'inline-block';
        signOutBtn.style.display = 'none';
        startBtn.disabled        = true;
      }
    });
    signInBtn.onclick  = () => auth.signInWithPopup(provider);
    signOutBtn.onclick = () => auth.signOut();

    // 5. Game variables
    let frames = 0,
        score = 0,
        pipes = [],
        bird = { x: 60, y: 300, w: 32, h: 32, dy: 0 },
        gravity = 0.5,
        jump = -8,
        pipeGap = 120,
        pipeWidth = 50,
        pipeSpeed = 2,
        raf;

    // 6. Controls
    function flap() {
      bird.dy = jump;
      flapSound.play();
    }
    document.addEventListener('keydown', e => {
      if (e.code === 'Space') flap();
    });
    canvas.addEventListener('click', flap);

    // 7. Game flow
    startBtn.onclick = () => {
      mainMenu.classList.remove('visible');
      canvas.style.display = 'block';
      startGame();
    };
    playAgain.onclick = () => {
      gameOver.classList.remove('visible');
      startGame();
    };

    function startGame() {
      // reset
      frames = 0; score = 0;
      bird.y = 300; bird.dy = 0;
      pipes = [];
      loop();
    }

    function endGame() {
      cancelAnimationFrame(raf);
      hitSound.play();
      dieSound.play();
      // push to Firebase
      const user = auth.currentUser;
      const name = user?.displayName || 'Anonymous';
      db.ref('leaderboard').push({
        username:  name,
        score:     score,
        timestamp: Date.now()
      });
      finalScore.textContent = score;
      gameOver.classList.add('visible');
    }

    // 8. Draw
    function draw() {
      // clear
      ctx.fillStyle = '#70c5ce';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // pipes
      ctx.fillStyle = '#228B22';
      for (let p of pipes) {
        ctx.fillRect(p.x, 0, pipeWidth, p.top);
        ctx.fillRect(p.x, p.top + pipeGap, pipeWidth, canvas.height - p.top - pipeGap);
      }

      // bird
      ctx.fillStyle = '#FFD700';
      ctx.beginPath();
      ctx.arc(bird.x, bird.y, bird.w/2, 0, Math.PI*2);
      ctx.fill();

      // floor
      ctx.fillStyle = '#DEB887';
      ctx.fillRect(0, canvas.height - 50, canvas.width, 50);

      // score
      ctx.fillStyle = '#fff';
      ctx.font = '32px sans-serif';
      ctx.fillText(score, canvas.width/2 - 10, 50);
    }

    // 9. Update
    function update() {
      frames++;

      // spawn pipe
      if (frames % 100 === 0) {
        const topHeight = 50 + Math.random() * (canvas.height - pipeGap - 150);
        pipes.push({ x: canvas.width, top: topHeight });
      }

      // move pipes & score
      for (let i = 0; i < pipes.length; i++) {
        let p = pipes[i];
        p.x -= pipeSpeed;

        // out of view
        if (p.x + pipeWidth < 0) pipes.splice(i, 1);

        // score
        if (!p.scored && p.x + pipeWidth < bird.x) {
          score++;
          p.scored = true;
          pointSound.play();
        }
      }

      // bird physics
      bird.dy += gravity;
      bird.y += bird.dy;

      // collisions
      for (let p of pipes) {
        if (
          bird.x + bird.w/2 > p.x &&
          bird.x - bird.w/2 < p.x + pipeWidth &&
          (bird.y - bird.h/2 < p.top ||
           bird.y + bird.h/2 > p.top + pipeGap)
        ) {
          return endGame();
        }
      }

      // hit ground or ceiling
      if (bird.y + bird.h/2 > canvas.height - 50 || bird.y - bird.h/2 < 0) {
        return endGame();
      }
    }

    // 10. Loop
    function loop() {
      update();
      draw();
      raf = requestAnimationFrame(loop);
    }

    // 11. Leaderboard
    showLbBtn.onclick = () => {
      lbList.innerHTML = '';
      lbModal.classList.add('visible');
      db.ref('leaderboard')
        .orderByChild('score')
        .limitToLast(10)
        .once('value', snap => {
          const arr = [];
          snap.forEach(c => arr.push(c.val()));
          arr.reverse().forEach((e, i) => {
            const li = document.createElement('li');
            const d = new Date(e.timestamp).toLocaleDateString();
            li.textContent = `${i+1}. ${e.username||'Anonymous'}: ${e.score} (${d})`;
            lbList.appendChild(li);
          });
        });
    };
    closeLbBtn.onclick = () => lbModal.classList.remove('visible');
  </script>
</body>
</html>
```[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://github.com/lzh-yi/Web-Fork-/tree/024b3e55587afdf9f05a677613a75f24e3d1803e/03-CSS%E8%BF%9B%E9%98%B6%2F04-%E5%A6%82%E4%BD%95%E8%AE%A9%E4%B8%80%E4%B8%AA%E5%85%83%E7%B4%A0%E6%B0%B4%E5%B9%B3%E5%9E%82%E7%9B%B4%E5%B1%85%E4%B8%AD%EF%BC%9F.md?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "1")
