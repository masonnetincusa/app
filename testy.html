<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flappy Bird Hub</title>
  <style>
    /* RESET & BASE FONT */
    * { margin:0; padding:0; box-sizing:border-box; }
    body, html { height:100%; font-family:MasonUI, sans-serif; background:#f5f5f5; }

    /* HEADER */
    .header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:20px 40px;
      background:#fff;
      box-shadow:0 2px 4px rgba(0,0,0,0.1);
    }
    .header h1 {
      font-size:36px;
      font-weight:bold;
      color:#333;
    }
    .profile-card span {
      font-size:18px;
      font-weight:500;
      color:#666;
    }

    /* MAIN MENU (vertical stack) */
    #menu-container {
      display:flex;
      flex-direction:column;
      align-items:center;
      margin-top:80px;
    }
    .menu-button {
      width:240px;
      padding:16px 0;
      margin:20px 0;
      font-size:32px;
      font-weight:bold;
      color:#fff;
      background:#1e90ff;
      border:none;
      border-radius:8px;
      cursor:pointer;
      transition:background 0.2s ease;
    }
    .menu-button:hover { background:#1c86ee; }

    /* GAME CANVAS & OVERLAYS */
    #game-container {
      position:relative;
      width:320px;
      height:480px;
      margin:40px auto;
      display:none;
    }
    #game-canvas {
      display:block;
      background:#70c5ce;
      border-radius:8px;
    }
    #game-over-overlay {
      position:absolute;
      top:0; left:0;
      width:100%; height:100%;
      background:rgba(0,0,0,0.5);
      display:none;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      color:#fff;
      font-size:32px;
    }
    .overlay-button {
      width:200px;
      padding:12px 0;
      margin:12px 0;
      font-size:28px;
      font-weight:bold;
      background:#ff4757;
      border:none;
      border-radius:6px;
      cursor:pointer;
      transition:background 0.2s ease;
    }
    .overlay-button:hover { background:#e84118; }
  </style>
</head>
<body>

  <div class="header">
    <h1>Flappy Bird Hub</h1>
    <div class="profile-card">
      <span>Logged in as Mason</span>
    </div>
  </div>

  <!-- MAIN MENU -->
  <div id="menu-container">
    <button id="start-btn" class="menu-button">Start Game</button>
    <button class="menu-button"
      onclick="window.location.href='https://app.masonnet.org/flappybirdhub/leaderboard'"
    >Leaderboard</button>
    <button class="menu-button"
      onclick="window.location.href='https://app.masonnet.org/flappybirdhub/settings'"
    >Settings</button>
  </div>

  <!-- GAME VIEW -->
  <div id="game-container">
    <canvas id="game-canvas" width="320" height="480"></canvas>
    <div id="game-over-overlay" class="flex">
      <div>Game Over</div>
      <div id="final-score" style="margin:12px 0;">Score: 0</div>
      <button id="restart-btn" class="overlay-button">Restart</button>
      <button id="menu-btn" class="overlay-button">Main Menu</button>
    </div>
  </div>

  <script>
    // SFX ASSETS
    const flapSound  = new Audio('https://app.masonnet.org/flap.mp3');
    const pointSound = new Audio('https://app.masonnet.org/point.mp3');
    const hitSound   = new Audio('https://app.masonnet.org/hit.mp3');
    const dieSound   = new Audio('https://app.masonnet.org/die.mp3');

    // DOM ELEMENTS
    const menuEl      = document.getElementById('menu-container');
    const gameContainer = document.getElementById('game-container');
    const overlayEl   = document.getElementById('game-over-overlay');
    const finalScoreEl= document.getElementById('final-score');
    const canvas      = document.getElementById('game-canvas');
    const ctx         = canvas.getContext('2d');

    let bird, pipes, score, gameLoopId, pipeTimer;

    // START & MENU BUTTONS
    document.getElementById('start-btn').addEventListener('click', () => {
      menuEl.style.display = 'none';
      gameContainer.style.display = 'block';
      initGame();
    });
    document.getElementById('menu-btn').addEventListener('click', () => {
      overlayEl.style.display = 'none';
      gameContainer.style.display = 'none';
      menuEl.style.display = 'flex';
    });
    document.getElementById('restart-btn').addEventListener('click', () => {
      overlayEl.style.display = 'none';
      initGame();
    });

    // GAME INITIALIZATION
    function initGame() {
      bird = { x:60, y:canvas.height/2, size:32, gravity:0.6, lift:-10, velocity:0 };
      pipes = [];
      score = 0;
      // clear any existing timers/loops
      if (pipeTimer) clearInterval(pipeTimer);
      cancelAnimationFrame(gameLoopId);

      // spawn a new pipe every 1.5s
      pipeTimer = setInterval(() => pipes.push(createPipe()), 1500);

      // start loop
      gameLoop();
    }

    // CREATE PIPE PAIR
    function createPipe() {
      const gap = 120;
      const topH = Math.random()*(canvas.height - gap - 80) + 20;
      return {
        x: canvas.width,
        w: 52,
        top: topH,
        bottom: canvas.height - topH - gap,
        passed: false
      };
    }

    // MAIN LOOP
    function gameLoop() {
      update();
      draw();
      gameLoopId = requestAnimationFrame(gameLoop);
    }

    // UPDATE LOGIC
    function update() {
      // bird physics
      bird.velocity += bird.gravity;
      bird.y += bird.velocity;
      if (bird.y + bird.size > canvas.height || bird.y < 0) {
        gameOver();
      }

      // pipes
      pipes.forEach(pipe => {
        pipe.x -= 2;
        // score
        if (!pipe.passed && pipe.x + pipe.w < bird.x) {
          pointSound.play();
          score++;
          pipe.passed = true;
        }
        // collision
        if (
          bird.x < pipe.x + pipe.w &&
          bird.x + bird.size > pipe.x &&
          (bird.y < pipe.top || bird.y + bird.size > canvas.height - pipe.bottom)
        ) {
          gameOver();
        }
      });
      // remove off-screen
      pipes = pipes.filter(p => p.x + p.w > 0);
    }

    // DRAW EVERYTHING
    function draw() {
      // clear
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // bird
      ctx.fillStyle = '#ffd500';
      ctx.fillRect(bird.x, bird.y, bird.size, bird.size);

      // pipes
      ctx.fillStyle = '#228B22';
      pipes.forEach(pipe => {
        ctx.fillRect(pipe.x, 0, pipe.w, pipe.top);
        ctx.fillRect(pipe.x, canvas.height - pipe.bottom, pipe.w, pipe.bottom);
      });

      // score
      ctx.fillStyle = '#fff';
      ctx.font = '32px MasonUI, sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText(score, canvas.width/2, 50);
    }

    // FLAP CONTROLS
    function flap() {
      bird.velocity = bird.lift;
      flapSound.play();
    }
    window.addEventListener('keydown', e => { if (e.code === 'Space') flap(); });
    canvas.addEventListener('pointerdown', flap);

    // GAME OVER HANDLER
    function gameOver() {
      clearInterval(pipeTimer);
      cancelAnimationFrame(gameLoopId);
      hitSound.play();
      dieSound.play();
      finalScoreEl.textContent = `Score: ${score}`;
      overlayEl.style.display = 'flex';
    }
  </script>
</body>
</html>
