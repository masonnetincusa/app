<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Flappy Bird</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { width:100%; height:100%; background:#000; color:#fff; font-family:Arial,sans-serif; overflow:hidden; }
    #menu { position:absolute; top:0; left:0; width:100%; height:100%; background:#000; display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:10; }
    #menu img { width:200px; margin-bottom:40px; }
    #menu button { width:200px; margin:10px 0; padding:12px; font-size:18px; background:red; color:#fff; border:none; cursor:pointer; }
    #canvas { display:none; position:absolute; top:0; left:0; width:100%; height:100%; }
    #pause { display:none; position:absolute; top:20px; right:20px; padding:8px 16px; background:red; color:#fff; border:none; cursor:pointer; z-index:5; }
    .modal { position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:none; align-items:center; justify-content:center; z-index:20; }
    .modal .box { background:#222; padding:20px; border-radius:6px; text-align:center; width:300px; }
    .modal .box h2 { margin-bottom:16px; }
    .modal .box button { margin-top:20px; width:100%; padding:10px; background:red; color:#fff; border:none; cursor:pointer; }
  </style>
</head>
<body>

  <!-- Main Menu -->
  <div id="menu">
    <img src="https://app.masonnet.org/fbrc.png" alt="Flappy Bird"/>
    <button id="startBtn">Start</button>
    <button id="leaderBtn">Leaderboard</button>
    <button id="settingsBtn">Settings</button>
    <button id="hubBtn">Flappy Bird Hub</button>
  </div>

  <!-- Pause Button -->
  <button id="pause">Pause</button>

  <!-- Game Canvas -->
  <canvas id="canvas"></canvas>

  <!-- Leaderboard Modal -->
  <div id="leaderModal" class="modal">
    <div class="box">
      <h2>Leaderboard</h2>
      <div id="leaderList" style="text-align:left;max-height:200px;overflow:auto;"></div>
      <button class="close">Close</button>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal">
    <div class="box">
      <h2>Settings</h2>
      <button id="toggleSound">ðŸ”Š Sound</button>
      <button id="toggleDark">ðŸŒ™ Dark Mode</button>
      <button class="close">Close</button>
    </div>
  </div>

  <script>
  // Assets
  const ASSETS = {
    bird:'https://app.masonnet.org/bird.png',
    pipe:'https://app.masonnet.org/pipe-green.png',
    flap:'https://app.masonnet.org/flap.mp3',
    hit:'https://app.masonnet.org/hit.mp3',
    die:'https://app.masonnet.org/die.mp3',
    point:'https://app.masonnet.org/point.mp3'
  };

  // DOM
  const menu       = document.getElementById('menu');
  const startBtn   = document.getElementById('startBtn');
  const leaderBtn  = document.getElementById('leaderBtn');
  const settingsBtn= document.getElementById('settingsBtn');
  const hubBtn     = document.getElementById('hubBtn');
  const pauseBtn   = document.getElementById('pause');
  const canvas     = document.getElementById('canvas');
  const ctx        = canvas.getContext('2d');
  const leaderMod  = document.getElementById('leaderModal');
  const settingsMod= document.getElementById('settingsModal');

  // Resize
  function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
  window.addEventListener('resize',resize);
  resize();

  // Sounds & Images
  const flapS  = new Audio(ASSETS.flap),
        hitS   = new Audio(ASSETS.hit),
        dieS   = new Audio(ASSETS.die),
        pointS = new Audio(ASSETS.point),
        birdImg= new Image(),
        pipeImg= new Image();
  birdImg.src = ASSETS.bird;
  pipeImg.src = ASSETS.pipe;

  // Game State
  let state='menu', bird, pipes, score, frame, raf, collided;
  const gravity=0.25, flapPower=-6, speed=2;

  class Bird {
    constructor(){
      this.x=50; this.y=canvas.height/2;
      this.w=34; this.h=24; this.vy=0;
    }
    flap(){ this.vy=flapPower; flapS.play().catch(()=>{}); }
    update(){
      this.vy+=gravity; this.y+=this.vy;
      if(this.y<0)this.y=0;
      if(this.y+this.h>canvas.height) this.die();
    }
    draw(){ ctx.drawImage(birdImg,this.x,this.y,this.w,this.h); }
    collides(p){
      return !(this.x+this.w < p.x ||
               this.x     > p.x+p.w ||
               this.y+this.h < p.top ||
               this.y     > p.bottom);
    }
    die(){
      if(state!=='playing'||collided) return;
      collided=true; state='ended';
      cancelAnimationFrame(raf);
      hitS.play().catch(()=>{ hitS.onended=()=>dieS.play().catch(()=>{}); });
    }
  }

  function spawnPipe(){
    const gap=120, top=20+Math.random()*(canvas.height-gap-40);
    pipes.push({ x:canvas.width, w:60, top, bottom:top+gap, passed:false });
  }

  function loop(){
    if(state!=='playing') return;
    raf = requestAnimationFrame(loop);
    frame++;
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Pipes
    pipes.forEach((p,i)=>{
      p.x -= speed;
      ctx.drawImage(pipeImg,p.x,0,p.w,p.top);
      ctx.drawImage(pipeImg,p.x,p.bottom,p.w,canvas.height-p.bottom);
      if(!p.passed && bird.x>p.x+p.w){
        p.passed=true; score++; pointS.play().catch(()=>{});
      }
      if(bird.collides(p)) bird.die();
      if(p.x+p.w < 0) pipes.splice(i,1);
    });

    // Bird
    bird.update(); bird.draw();

    // Spawn
    if(frame%150===0) spawnPipe();

    // Draw Score
    ctx.fillStyle = '#fff';
    ctx.font = '32px Arial';
    ctx.fillText(score,20,50);
  }

  function startGame(){
    bird = new Bird();
    pipes = [];
    score = 0;
    frame = 0;
    collided = false;
    state = 'playing';
    menu.style.display = 'none';
    pauseBtn.style.display = 'block';
    loop();
  }

  // Event Listeners
  startBtn.onclick = startGame;
  pauseBtn.onclick = ()=>{
    if(state==='playing'){
      cancelAnimationFrame(raf);
      menu.style.display='flex';
      state='paused';
    }
  };
  canvas.addEventListener('mousedown', ()=>{ if(state==='playing') bird.flap(); });
  canvas.addEventListener('touchstart',e=>{ e.preventDefault(); if(state==='playing') bird.flap(); });

  leaderBtn.onclick = ()=>{
    const list = leaderMod.querySelector('#leaderList');
    list.innerHTML = '<div>1. Alice â€“ 999</div><div>2. Bob â€“ 888</div><div>â€¦</div>';
    leaderMod.style.display = 'flex';
  };
  settingsBtn.onclick = ()=> settingsMod.style.display = 'flex';
  [ ...leaderMod.querySelectorAll('.close'), ...settingsMod.querySelectorAll('.close') ]
    .forEach(b=>b.onclick=()=>{ leaderMod.style.display='none'; settingsMod.style.display='none'; });

  hubBtn.onclick = ()=> window.location.href='https://app.masonnet.org/flappybirdhub';

  </script>
</body>
</html>
