<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flappy Bird Hub</title>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <style>
    /* Reset & basics */
    * { margin: 0; padding: 0; box-sizing: border-box }
    body { font-family: sans-serif; background: #87CEEB; overflow: hidden; }
    body.dark { background: #2c3e50; color: #ecf0f1 }
    button { cursor: pointer; padding: .5em 1em; border: none; border-radius: 4px; }
    /* Main menu */
    #menu { position: absolute; top: 50%; left:50%; transform: translate(-50%,-50%); text-align: center; }
    #menu img { width: 128px; margin-bottom: 1em; }
    #menu button { display: block; width: 200px; margin: .5em auto; background: #27ae60; color: #fff }
    /* Canvas */
    #gameCanvas { display: none; background: #70c5ce; margin: 0 auto; border: 2px solid #000; }
    /* Overlays (modals) */
    .overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,.6); justify-content: center; align-items: center; }
    .modal { background: #fff; padding: 1.5em; border-radius: 8px; width: 90%; max-width: 320px; position: relative; }
    .modal.dark { background: #34495e; color: #ecf0f1 }
    .modal .close { position: absolute; top: .5em; right: .5em; cursor: pointer; font-size: 1.2em }
    /* Lists & inputs */
    ul { list-style: none; margin-top: 1em }
    li { margin: .5em 0 }
    label { display: flex; justify-content: space-between; align-items: center }
    /* Profile card */
    #profileCard img { width: 64px; border-radius: 50%; margin-bottom: .5em }
    /* Diagnostics */
    #diagConsole { width: 100%; height: 150px; background: #000; color: #0f0; overflow: auto; font-family: monospace; padding: .5em; margin-top: .5em }
  </style>
</head>
<body>
  <!-- MAIN MENU -->
  <div id="menu">
    <img src="https://app.masonnet.org/fbrc.png" alt="Flappy Bird Hub Logo"/>
    <button id="playBtn">Play</button>
    <button id="lbBtn">Leaderboard</button>
    <button id="settingsBtn">Settings</button>
    <button id="loginBtn">Log In</button>
    <button id="profileBtn" style="display:none;">Profile</button>
    <button id="logoutBtn" style="display:none;">Log Out</button>
  </div>

  <!-- GAME CANVAS -->
  <canvas id="gameCanvas" width="320" height="480"></canvas>

  <!-- OVERLAYS -->
  <!-- Settings -->
  <div id="settingsOverlay" class="overlay">
    <div class="modal" id="settingsModal">
      <span class="close" data-close="settingsOverlay">&times;</span>
      <h2>Settings</h2>
      <ul>
        <li>
          <label>Sound
            <input type="checkbox" id="toggleSound"/>
          </label>
        </li>
        <li>
          <label>Dark Mode
            <input type="checkbox" id="toggleDark"/>
          </label>
        </li>
        <li>
          <label>Skip to Game Over
            <input type="checkbox" id="toggleSkip"/>
          </label>
        </li>
      </ul>
    </div>
  </div>

  <!-- Leaderboard -->
  <div id="lbOverlay" class="overlay">
    <div class="modal" id="lbModal">
      <span class="close" data-close="lbOverlay">&times;</span>
      <h2>Top 10 Scores</h2>
      <ol id="lbList"></ol>
    </div>
  </div>

  <!-- Profile -->
  <div id="profileOverlay" class="overlay">
    <div class="modal" id="profileModal">
      <span class="close" data-close="profileOverlay">&times;</span>
      <h2>Your Profile</h2>
      <img id="profilePic" src="https://app.masonnet.org/default-avatar.png" alt="Avatar"/>
      <p id="profileName"></p>
      <p id="profileEmail"></p>
    </div>
  </div>

  <!-- Game Over -->
  <div id="gameOverOverlay" class="overlay">
    <div class="modal" id="gameOverModal">
      <span class="close" data-close="gameOverOverlay">&times;</span>
      <h2>Game Over</h2>
      <p>Your score: <span id="finalScore">0</span></p>
      <button id="retryBtn">Play Again</button>
      <button id="menuBtn">Main Menu</button>
    </div>
  </div>

  <!-- Diagnostics (admin only) -->
  <div id="diagOverlay" class="overlay">
    <div class="modal" id="diagModal">
      <span class="close" data-close="diagOverlay">&times;</span>
      <h2>Diagnostics</h2>
      <div id="diagConsole"></div>
    </div>
  </div>

  <!-- Firebase + Game Logic -->
  <script>
  // Firebase config â€“ replace with your own
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyDtfrpxKaROrq1D0NUAbFl0FZ9E7axOIxE",
  authDomain: "masonnet-app-official.firebaseapp.com",
  databaseURL: "https://masonnet-app-official-default-rtdb.firebaseio.com",
  projectId: "masonnet-app-official",
  storageBucket: "masonnet-app-official.firebasestorage.app",
  messagingSenderId: "783919367562",
  appId: "1:783919367562:web:b7bb809332a4e873f3b473",
  measurementId: "G-X1YKV5VK7J"
};
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Admin emails placeholder
  const adminEmails = ["admin@example.com"];

  // UI elements
  const menu       = document.getElementById('menu');
  const playBtn    = document.getElementById('playBtn');
  const lbBtn      = document.getElementById('lbBtn');
  const settingsBtn= document.getElementById('settingsBtn');
  const loginBtn   = document.getElementById('loginBtn');
  const logoutBtn  = document.getElementById('logoutBtn');
  const profileBtn = document.getElementById('profileBtn');
  const canvas     = document.getElementById('gameCanvas');
  const ctx        = canvas.getContext('2d');

  // Overlays
  const overlays = document.querySelectorAll('.overlay');
  function showOverlay(id) { document.getElementById(id).style.display='flex'; applyDarkMode(); }
  function hideOverlay(e) {
    const id = e.target.getAttribute('data-close');
    if(id) document.getElementById(id).style.display='none';
  }
  document.body.addEventListener('click', hideOverlay);

  // Settings
  let enableSound = JSON.parse(localStorage.getItem('sound')) || false;
  let darkMode    = JSON.parse(localStorage.getItem('dark')) || false;
  let skipToOver  = JSON.parse(localStorage.getItem('skip')) || false;
  document.getElementById('toggleSound').checked = enableSound;
  document.getElementById('toggleDark').checked  = darkMode;
  document.getElementById('toggleSkip').checked  = skipToOver;
  function applyDarkMode(){
    document.body.classList.toggle('dark', darkMode);
    document.querySelectorAll('.modal').forEach(m=>m.classList.toggle('dark', darkMode));
  }
  ['Sound','Dark','Skip'].forEach(t=>{
    document.getElementById('toggle'+t).addEventListener('change', e=>{
      window[''+(t==='Dark'?'dark':'toggle'+t.charAt(0).toLowerCase()+t.slice(1))] = e.target.checked;
      localStorage.setItem((t==='Dark'?'dark':t.toLowerCase()), e.target.checked);
      if(t==='Dark') applyDarkMode();
    });
  });
  applyDarkMode();

  // Auth & Profile
  auth.onAuthStateChanged(user=>{
    if(user){
      loginBtn.style.display='none';
      logoutBtn.style.display='block';
      profileBtn.style.display='block';
      document.getElementById('profileName').textContent = user.displayName;
      document.getElementById('profileEmail').textContent= user.email;
      document.getElementById('profilePic').src = user.photoURL || 'https://app.masonnet.org/default-avatar.png';
    } else {
      loginBtn.style.display='block';
      logoutBtn.style.display='none';
      profileBtn.style.display='none';
    }
    // show diagnostics if admin
    if(user && adminEmails.includes(user.email)){
      document.getElementById('diagConsole').textContent = 'Admin console ready...\n';
      document.getElementById('diagOverlay').style.display = 'none';
      // we can add a button or max-key combo to open diagOverlay
      document.addEventListener('keydown', e=>{
        if(e.ctrlKey && e.key==='D') showOverlay('diagOverlay');
      });
    }
  });
  loginBtn.onclick = ()=> auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
  logoutBtn.onclick = ()=> auth.signOut();
  profileBtn.onclick = ()=> showOverlay('profileOverlay');

  // Leaderboard
  lbBtn.onclick = ()=>{
    showOverlay('lbOverlay');
    const list = document.getElementById('lbList');
    list.innerHTML = '<li>Loading...</li>';
    db.collection('scores')
      .orderBy('score','desc')
      .limit(10)
      .get()
      .then(snap=>{
        list.innerHTML = '';
        snap.forEach(doc=>{
          const data = doc.data();
          const li = document.createElement('li');
          li.textContent = `${data.name}: ${data.score}`;
          list.appendChild(li);
        });
      })
      .catch(err=> {
        list.innerHTML = '<li>Error loading scores</li>';
        console.error(err);
      });
  };

  // Settings & Menu
  settingsBtn.onclick = ()=> showOverlay('settingsOverlay');
  playBtn.onclick = ()=> startGame();

  // Game Over overlay buttons
  document.getElementById('retryBtn').onclick = ()=> startGame();
  document.getElementById('menuBtn').onclick  = ()=> { showMenu(); };

  function showMenu(){
    cancelAnimationFrame(animationId);
    canvas.style.display='none';
    menu.style.display='block';
    overlays.forEach(o=>o.style.display='none');
  }

  // GAME LOOP
  let pipes, bird, score, animationId, gameOver;
  function resetGame(){
    bird = { x:50, y:240, vel:0, w:34, h:24 };
    pipes = [];
    score = 0;
    gameOver = false;
  }

  function spawnPipe(){
    const gap = 120;
    const topH = Math.random()*(canvas.height - gap - 40) + 20;
    pipes.push({ x: canvas.width, top: topH, bottom: topH + gap, w: 40 });
  }

  function update(){
    // gravity
    bird.vel += 0.6;
    bird.y += bird.vel;
    // spawn pipes
    if(frameCount % 90 === 0) spawnPipe();
    // update pipes
    pipes.forEach((p,i)=>{
      p.x -= 2;
      // passed pipe?
      if(p.x + p.w < bird.x && !p.passed){
        p.passed = true;
        score++;
        if(enableSound){
          const s = new Audio('https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg');
          s.play();
        }
      }
      // collision
      if(bird.x < p.x + p.w && bird.x + bird.w > p.x &&
         (bird.y < p.top || bird.y + bird.h > p.bottom)){
        gameOver = true;
      }
      // remove off-screen pipes
      if(p.x + p.w < 0) pipes.splice(i,1);
    });
    // hit floor or ceiling
    if(bird.y + bird.h > canvas.height || bird.y < 0) gameOver = true;
  }

  function draw(){
    // clear
    ctx.fillStyle = enableDark?'#2c3e50':'#70c5ce';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    // bird
    ctx.fillStyle = '#e74c3c';
    ctx.fillRect(bird.x,bird.y,bird.w,bird.h);
    // pipes
    ctx.fillStyle = '#27ae60';
    pipes.forEach(p=>{
      ctx.fillRect(p.x,0,p.w,p.top);
      ctx.fillRect(p.x,p.bottom,p.w,canvas.height - p.bottom);
    });
    // score
    ctx.fillStyle = '#000';
    ctx.font = '24px sans-serif';
    ctx.fillText(score, canvas.width/2 - 6, 40);
  }

  let frameCount;
  function gameLoop(){
    frameCount++;
    update();
    draw();
    if(gameOver) return endGame();
    animationId = requestAnimationFrame(gameLoop);
  }

  function endGame(){
    // submit if logged in
    const user = auth.currentUser;
    if(user){
      db.collection('scores').add({
        uid: user.uid,
        name: user.displayName,
        score,
        ts: firebase.firestore.FieldValue.serverTimestamp()
      }).catch(console.error);
    }
    document.getElementById('finalScore').textContent = score;
    showOverlay('gameOverOverlay');
  }

  function startGame(){
    menu.style.display='none';
    overlays.forEach(o=>o.style.display='none');
    canvas.style.display='block';
    resetGame();
    frameCount = 0;
    if(skipToOver){
      gameOver = true;
      return endGame();
    }
    gameLoop();
  }

  // flap control
  canvas.addEventListener('mousedown', ()=> bird.vel = -10 );
  canvas.addEventListener('touchstart', e=>{ e.preventDefault(); bird.vel = -10 });

  // initial state
  showMenu();
  </script>
</body>
</html>
