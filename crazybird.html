<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flappy Bird â€“ Start Fix</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#000; color:#fff; }
    #game-container { position:relative; width:100%; height:100%; }
    canvas { display:block; width:100%; height:100%; background:#000; }
    .overlay {
      position:absolute; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.8); display:flex; flex-direction:column;
      align-items:center; justify-content:center; text-align:center;
    }
    .hidden { display:none; }
    button {
      background:#e74c3c; border:none; color:#fff;
      padding:12px 24px; margin:8px; font-size:16px; cursor:pointer;
      touch-action: manipulation;
    }
    #score { position:absolute; top:10px; left:10px; font-size:24px; z-index:5; }
    #pauseBtn { position:absolute; top:10px; right:10px; display:none; }
  </style>
</head>
<body>
  <div id="game-container">
    <canvas id="canvas"></canvas>
    <div id="score">0</div>
    <button id="pauseBtn">Pause</button>

    <!-- Main Menu -->
    <div id="menu" class="overlay">
      <h1>Flappy Bird</h1>
      <button id="startBtn">Start</button>
      <button id="leaderboardBtn">Leaderboard</button>
    </div>

    <!-- Leaderboard -->
    <div id="leaderboard" class="overlay hidden">
      <h2>Top Scores</h2>
      <div id="lb-list">No data</div>
      <button id="backFromLbBtn">Back</button>
    </div>

    <!-- Pause Menu -->
    <div id="pause" class="overlay hidden">
      <h2>Paused</h2>
      <button id="resumeBtn">Resume</button>
      <button id="backFromPauseBtn">Main Menu</button>
    </div>

    <!-- Game Over -->
    <div id="gameover" class="overlay hidden">
      <h2>Game Over</h2>
      <p>Your Score: <span id="finalScore">0</span></p>
      <button id="restartBtn">Restart</button>
      <button id="backFromGameOverBtn">Main Menu</button>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // Canvas & UI elements
    const canvas     = document.getElementById('canvas');
    const ctx        = canvas.getContext('2d');
    const scoreDiv   = document.getElementById('score');
    const pauseBtn   = document.getElementById('pauseBtn');
    const startBtn   = document.getElementById('startBtn');
    const lbBtn      = document.getElementById('leaderboardBtn');
    const backLbBtn  = document.getElementById('backFromLbBtn');
    const resumeBtn  = document.getElementById('resumeBtn');
    const backPause  = document.getElementById('backFromPauseBtn');
    const restartBtn = document.getElementById('restartBtn');
    const backGoBtn  = document.getElementById('backFromGameOverBtn');
    const finalScore = document.getElementById('finalScore');

    // Game state
    let state = 'menu'; // menu, leaderboard, playing, paused, gameover
    let bird, pipes, score, frame, anim;

    // Resize canvas
    function resize(){
      canvas.width  = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // Bird
    class Bird {
      constructor(){
        this.w=30; this.h=30;
        this.x=50; this.y=(canvas.height - this.h)/2;
        this.vy=0; this.g=0.3;
      }
      update(){
        this.vy+=this.g; this.y+=this.vy;
        if(this.y<0) this.y=0;
        if(this.y+this.h>canvas.height) this.y=canvas.height - this.h;
      }
      draw(){
        ctx.fillStyle='yellow';
        ctx.fillRect(this.x,this.y,this.w,this.h);
      }
      flap(){ this.vy=-6; }
      collides(p){
        return !(
          this.x+this.w < p.x ||
          this.x     > p.x+p.w ||
          this.y+this.h < p.y ||
          this.y     > p.y+p.h
        );
      }
    }

    // Spawn pipes (tag top only)
    function spawn(){
      const x   = canvas.width;
      const h   = 20 + Math.random()*(canvas.height/2 - 20);
      const gap = 120 + Math.random()*80;
      pipes = pipes.filter(p=>p.x + p.w > 0);
      if(pipes.length<2 || x - pipes[pipes.length-2].x > 200){
        pipes.push({ x, y:0,     w:40, h,                 passed:false, isTop:true  });
        pipes.push({ x, y:h+gap, w:40, h:canvas.height-h-gap, passed:false, isTop:false });
      }
    }

    // Main loop
    function loop(){
      if(state!=='playing') return;
      frame++;
      ctx.clearRect(0,0,canvas.width,canvas.height);

      if(frame===1 || frame%150===0) spawn();
      pipes.forEach(p=>{
        p.x-=2;
        ctx.fillStyle='green';
        ctx.fillRect(p.x,p.y,p.w,p.h);
      });
      pipes = pipes.filter(p=>p.x + p.w>0);

      bird.update(); bird.draw();

      pipes.forEach(p=>{
        if(p.isTop && !p.passed && bird.x>p.x+p.w){
          p.passed=true; score++;
          scoreDiv.textContent = score;
        }
        if(bird.collides(p)) endGame();
      });

      anim = requestAnimationFrame(loop);
    }

    // Overlay helpers
    function hideAll(){
      ['menu','leaderboard','pause','gameover']
        .forEach(id=>document.getElementById(id).classList.add('hidden'));
      pauseBtn.style.display = 'none';
    }
    function show(id){
      hideAll();
      if(id==='playing'){
        pauseBtn.style.display='block';
        return;
      }
      document.getElementById(id).classList.remove('hidden');
    }

    // Start
    function startGame(){
      state='playing';
      bird   = new Bird();
      pipes  = [];
      score  = 0;
      frame  = 0;
      scoreDiv.textContent = score;
      show('playing');
      cancelAnimationFrame(anim);
      loop();
    }

    // Leaderboard
    function showLB(){
      state='leaderboard';
      show('leaderboard');
    }

    // Pause
    function pauseGame(){
      if(state!=='playing') return;
      state='paused';
      cancelAnimationFrame(anim);
      show('pause');
    }
    function resumeGame(){
      if(state!=='paused') return;
      state='playing';
      show('playing');
      cancelAnimationFrame(anim);
      loop();
    }

    // Game Over
    function endGame(){
      cancelAnimationFrame(anim);
      state='gameover';
      finalScore.textContent = score;
      show('gameover');
    }
    function restartGame(){
      startGame();
    }
    function backToMenu(){
      state='menu';
      show('menu');
    }

    // Bind one click+touch for each action
    function bind(id, fn){
      const el = document.getElementById(id);
      el.addEventListener('click', fn);
      el.addEventListener('touchend', e=>{
        e.preventDefault();
        fn();
      });
    }

    bind('startBtn',       startGame);
    bind('leaderboardBtn', showLB);
    bind('backFromLbBtn',  backToMenu);
    bind('pauseBtn',       pauseGame);
    bind('resumeBtn',      resumeGame);
    bind('backFromPauseBtn', backToMenu);
    bind('restartBtn',     restartGame);
    bind('backFromGameOverBtn', backToMenu);

    // Controls
    window.addEventListener('keydown', e=>{
      if(e.code==='Space' && state==='playing'){ bird.flap(); e.preventDefault(); }
      if(e.key==='k'    && state==='playing'){ pauseGame(); }
    });
    window.addEventListener('touchstart', e=>{
      if(state==='playing'){ bird.flap(); e.preventDefault(); }
    });

    // Show initial menu
    show('menu');
  });
  </script>
</body>
</html>
