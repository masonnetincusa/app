<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flappy Bird – Full‐Contact Game Over</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#000; color:#fff; }
    #game-container { position:relative; width:100%; height:100%; }
    canvas { display:block; width:100%; height:100%; }
    .overlay {
      position:absolute; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.8); display:flex; flex-direction:column;
      align-items:center; justify-content:center; text-align:center;
      font-family:Arial,sans-serif; z-index:10;
    }
    .hidden { display:none; }
    button {
      background:#e74c3c; border:none; color:#fff;
      padding:12px 24px; margin:8px; font-size:16px; cursor:pointer;
      touch-action: manipulation;
    }
    #score { position:absolute; top:10px; left:10px; font-size:24px; z-index:5; }
    #pauseBtn { position:absolute; top:10px; right:10px; display:none; z-index:5; }
    #lb-list, #lb-list-go {
      text-align:left; width:80%; max-height:150px; overflow-y:auto; margin:12px 0;
    }
    #lb-list div, #lb-list-go div { border-bottom:1px solid #444; padding:4px 0; }
  </style>
</head>
<body>
  <div id="game-container">
    <canvas id="canvas"></canvas>
    <div id="score">0</div>
    <button id="pauseBtn">Pause</button>

    <div id="menu" class="overlay">
      <h1>Flappy Bird</h1>
      <button id="startBtn">Start</button>
      <button id="leaderboardBtn">Leaderboard</button>
    </div>

    <div id="leaderboard" class="overlay hidden">
      <h2>Top 10 Scores</h2>
      <div id="lb-list"></div>
      <button id="backFromLbBtn">Back</button>
    </div>

    <div id="pause" class="overlay hidden">
      <h2>Paused</h2>
      <button id="resumeBtn">Resume</button>
      <button id="backFromPauseBtn">Main Menu</button>
    </div>

    <div id="gameover" class="overlay hidden">
      <h2>Game Over</h2>
      <p>Your Score: <span id="finalScore">0</span></p>
      <div id="lb-list-go"></div>
      <button id="restartBtn">Restart</button>
      <button id="backFromGameOverBtn">Main Menu</button>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const canvas     = document.getElementById('canvas');
    const ctx        = canvas.getContext('2d');
    const scoreDiv   = document.getElementById('score');
    const pauseBtn   = document.getElementById('pauseBtn');
    const finalScore = document.getElementById('finalScore');

    const overlays = {
      menu:       document.getElementById('menu'),
      leaderboard:document.getElementById('leaderboard'),
      pause:      document.getElementById('pause'),
      gameover:   document.getElementById('gameover')
    };

    // localStorage leaderboard
    let lb = JSON.parse(localStorage.getItem('flappyLB')||'[]');
    function saveLB() { localStorage.setItem('flappyLB', JSON.stringify(lb)); }
    function renderLB(sel) {
      const div = document.querySelector(sel);
      div.innerHTML = '';
      lb.slice(0,10).forEach((e,i)=>{
        const d = document.createElement('div');
        d.textContent = `${i+1}. ${e.name}: ${e.score}`;
        div.appendChild(d);
      });
    }

    let state='menu', bird, pipes, score, frame, animId;

    function resize(){
      canvas.width  = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // returns true if bird is 100% overlapped by pipe p
    function fullOverlap(b, p) {
      const xO = Math.min(b.x+b.w, p.x+p.w) - Math.max(b.x, p.x);
      const yO = Math.min(b.y+b.h, p.y+p.h) - Math.max(b.y, p.y);
      if (xO <= 0 || yO <= 0) return false;
      return (xO * yO) >= (b.w * b.h);
    }

    class Bird {
      constructor(){
        this.w=30; this.h=30;
        this.x=50; this.y=(canvas.height - this.h)/2;
        this.vy=0; this.g=0.3;
      }
      update(){
        this.vy += this.g;
        this.y  += this.vy;

        // ceiling
        if (this.y < 0) {
          this.y = 0; this.vy = 0;
        }
        // floor: only when truly flush
        if (this.y + this.h >= canvas.height) {
          this.y = canvas.height - this.h;
          endGame();
        }
      }
      draw(){
        ctx.fillStyle='yellow';
        ctx.fillRect(this.x, this.y, this.w, this.h);
      }
      flap(){ this.vy = -6; }
      collides(p){
        // we’ll use fullOverlap() in loop()
        return false;
      }
    }

    function spawnPipes(){
      const x   = canvas.width;
      const h   = 20 + Math.random()*(canvas.height/2 - 20);
      const gap = 120 + Math.random()*80;
      pipes = pipes.filter(p=>p.x + p.w > 0);
      if (pipes.length < 2 || x - pipes[pipes.length-2].x > 200) {
        pipes.push({ x, y:0, w:40, h, passed:false, isTop:true  });
        pipes.push({ x, y:h+gap, w:40, h:canvas.height-h-gap, passed:false, isTop:false });
      }
    }

    function loop(){
      if (state!=='playing') return;
      frame++;
      ctx.clearRect(0,0,canvas.width,canvas.height);

      if (frame===1 || frame%150===0) spawnPipes();
      pipes.forEach(p=>{
        p.x -= 2;
        ctx.fillStyle='green';
        ctx.fillRect(p.x, p.y, p.w, p.h);
      });
      pipes = pipes.filter(p=>p.x+p.w>0);

      bird.update();
      bird.draw();

      // pipe collision: full‐contact only
      pipes.forEach(p=>{
        if (fullOverlap(bird, p)) endGame();
        // score on top‐pipe once it fully passes
        if (p.isTop && !p.passed && bird.x > p.x + p.w) {
          p.passed = true;
          score++;
          scoreDiv.textContent = score;
        }
      });

      animId = requestAnimationFrame(loop);
    }

    function hideAll(){
      Object.values(overlays).forEach(o=>o.classList.add('hidden'));
      pauseBtn.style.display='none';
    }
    function show(id){
      hideAll();
      if (id==='playing') {
        pauseBtn.style.display='block';
      } else if (overlays[id]) {
        overlays[id].classList.remove('hidden');
      }
    }

    function startGame(){
      state='playing'; bird=new Bird(); pipes=[]; score=0; frame=0;
      scoreDiv.textContent=score;
      show('playing'); cancelAnimationFrame(animId); loop();
    }
    function showLeaderboard(){
      state='leaderboard'; renderLB('#lb-list'); show('leaderboard');
    }
    function pauseGame(){
      if (state!=='playing') return;
      state='paused'; cancelAnimationFrame(animId); show('pause');
    }
    function resumeGame(){
      if (state!=='paused') return;
      state='playing'; show('playing'); cancelAnimationFrame(animId); loop();
    }
    function backToMenu(){
      state='menu'; show('menu');
    }
    function endGame(){
      cancelAnimationFrame(animId);
      state='gameover';
      finalScore.textContent = score;
      const name = prompt('Enter name:','Anon')||'Anon';
      lb.unshift({name,score});
      lb.sort((a,b)=>b.score-a.score);
      lb = lb.slice(0,10);
      saveLB(); renderLB('#lb-list-go');
      show('gameover');
    }
    function restartGame(){ startGame(); }

    function bind(id,fn){
      const el=document.getElementById(id);
      el.addEventListener('click', fn);
      el.addEventListener('touchend', e=>{e.preventDefault(); fn();});
    }
    bind('startBtn',        startGame);
    bind('leaderboardBtn',  showLeaderboard);
    bind('backFromLbBtn',   backToMenu);
    bind('pauseBtn',        pauseGame);
    bind('resumeBtn',       resumeGame);
    bind('backFromPauseBtn',backToMenu);
    bind('restartBtn',      restartGame);
    bind('backFromGameOverBtn', backToMenu);

    // controls: keyboard & touch
    window.addEventListener('keydown', e=>{
      if (e.code==='Space' && state==='playing'){ bird.flap(); e.preventDefault(); }
      if (e.key==='k' && state==='playing'){ pauseGame(); }
    });
    window.addEventListener('touchstart', e=> {
      if (state==='playing'){ bird.flap(); e.preventDefault(); }
    });
    // canvas click/mousedown to flap
    canvas.addEventListener('click', e=>{
      if (state==='playing'){ bird.flap(); e.preventDefault(); }
    });
    canvas.addEventListener('mousedown', e=>{
      if (state==='playing'){ bird.flap(); e.preventDefault(); }
    });

    show('menu');
  });
  </script>
</body>
</html>
