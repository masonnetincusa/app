<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Flappy Bird with Firebase</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    html,body {margin:0;padding:0;width:100%;height:100%;overflow:hidden;background:#222;color:#fff}
    #game-container {position:relative;width:100%;height:100%;background:#000}
    canvas {display:block;width:100%;height:100%}
    .overlay {
      position:absolute;top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,0.85);display:flex;flex-direction:column;
      align-items:center;justify-content:center;text-align:center;
      font-family:Arial,sans-serif;z-index:10
    }
    .hidden {display:none}
    button {
      background:#f00;border:none;color:#fff;
      padding:12px 24px;margin:8px;font-size:16px;cursor:pointer
    }
    #score {position:absolute;top:10px;left:10px;font-size:24px;z-index:5}
    #pauseBtn {
      position:absolute;top:10px;right:10px;
      background:#f00;border:none;color:#fff;
      padding:8px 16px;font-size:14px;cursor:pointer;z-index:5
    }
    #lbList, #lbListGo {
      text-align:left;width:80%;max-height:150px;overflow-y:auto;margin:12px 0
    }
    #lbList div,#lbListGo div{border-bottom:1px solid #444;padding:4px 0}
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-database-compat.js"></script>
</head>
<body>
  <div id="game-container">
    <canvas id="canvas"></canvas>
    <div id="score">0</div>
    <button id="pauseBtn" class="hidden">Pause</button>

    <!-- Main Menu -->
    <div id="menu" class="overlay">
      <h1>Flappy Bird</h1>
      <button id="startBtn">Start</button>
      <button id="showLbBtn">Leaderboard</button>
    </div>

    <!-- Leaderboard Menu -->
    <div id="leaderboard" class="overlay hidden">
      <h2>Global Top 10</h2>
      <div id="lbList"></div>
      <button id="backFromLbBtn">Back</button>
    </div>

    <!-- Pause Menu -->
    <div id="pause" class="overlay hidden">
      <h2>Paused</h2>
      <button id="resumeBtn">Resume</button>
      <button id="backFromPauseBtn">Main Menu</button>
    </div>

    <!-- Game Over -->
    <div id="gameover" class="overlay hidden">
      <h2>Game Over</h2>
      <p>Your Score: <span id="finalScore">0</span></p>
      <div id="lbListGo"></div>
      <button id="restartBtn">Restart</button>
      <button id="backFromGameOverBtn">Main Menu</button>
    </div>
  </div>

  <script>
  window.onload = function() {
    // == CONFIGURE HERE ==
    const BACKGROUND_URL = "https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/089918d8-99ff-45de-a084-3fe85d0e3fcc/dg34rsu-29a3d144-dc3f-473e-a949-f73a4ba1ef7c.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9NDU3IiwicGF0aCI6IlwvZlwvMDg5OTE4ZDgtOTlmZi00NWRlLWEwODQtM2ZlODVkMGUzZmNjXC9kZzM0cnN1LTI5YTNkMTQ0LWRjM2YtNDczZS1hOTQ5LWY3M2E0YmExZWY3Yy5wbmciLCJ3aWR0aCI6Ijw9NjA4In1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmltYWdlLm9wZXJhdGlvbnMiXX0._FI7nnUO3ZCIz23z4_juaIbbiEa_LQd1lX6MK-0iUEE";
    const BIRD_IMG_URL   = "https://app.masonnet.org/bird.png";
    const PIPE_IMG_URL   = "https://app.masonnet.org/pipe-green.png";
    const firebaseConfig = {
  apiKey: "AIzaSyA4YGz73C13yVjqqMzpM2oJHHqJebYwnOU",
  authDomain: "masonnet-app.firebaseapp.com",
  databaseURL: "https://masonnet-app-default-rtdb.firebaseio.com",
  projectId: "masonnet-app",
  storageBucket: "masonnet-app.firebasestorage.app",
  messagingSenderId: "245878148284",
  appId: "1:245878148284:web:2b3f54cebc08ad14b594b9",
  measurementId: "G-NY1MN2R295"
};
    // ====================

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref("leaderboard");

    // Canvas setup
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resize);
    resize();

    // Preload images
    const bgImg = new Image(); bgImg.src = https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/089918d8-99ff-45de-a084-3fe85d0e3fcc/dg34rsu-29a3d144-dc3f-473e-a949-f73a4ba1ef7c.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9NDU3IiwicGF0aCI6IlwvZlwvMDg5OTE4ZDgtOTlmZi00NWRlLWEwODQtM2ZlODVkMGUzZmNjXC9kZzM0cnN1LTI5YTNkMTQ0LWRjM2YtNDczZS1hOTQ5LWY3M2E0YmExZWY3Yy5wbmciLCJ3aWR0aCI6Ijw9NjA4In1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmltYWdlLm9wZXJhdGlvbnMiXX0._FI7nnUO3ZCIz23z4_juaIbbiEa_LQd1lX6MK-0iUEE;
    const birdImg = new Image(); birdImg.src = https://app.masonnet.org/bird.png;
    const pipeImg = new Image(); pipeImg.src = https://app.masonnet.org/pipe-green.png;

    // Game state
    let state = "menu"; // menu, playing, paused, leaderboard, gameover
    let bird, pipes, score, frameNo, animId;

    // Utility: show/hide overlays
    function hideAll() {
      ["menu","leaderboard","pause","gameover"].forEach(id=>
        document.getElementById(id).classList.add("hidden"));
      pauseBtn.classList.add("hidden");
    }
    function show(id) {
      hideAll();
      if(id) document.getElementById(id).classList.remove("hidden");
    }

    // Bird class
    class Bird {
      constructor(){
        this.w = 30; this.h = 30;
        this.x = 50; this.y = canvas.height/2 - 15;
        this.vy = 0; this.g = 0.2;
      }
      update(){
        this.vy += this.g;
        this.y += this.vy;
        if(this.y < 0){ this.y=0; this.vy=0; }
        if(this.y+this.h > canvas.height) endGame();
      }
      draw(){
        ctx.drawImage(birdImg, this.x, this.y, this.w, this.h);
      }
      flap(){
        this.vy = -6;
      }
      collides(p){
        return !(
          this.x+this.w < p.x ||
          this.x > p.x+p.w ||
          this.y+this.h < p.y ||
          this.y > p.y+p.h
        );
      }
    }

    // Spawn pipes
    function spawnPipes(){
      const x = canvas.width;
      const h = 20 + Math.random()*(canvas.height/2 -20);
      const gap = 120 + Math.random()*80;
      pipes = pipes.filter(p=>p.x + p.w > 0);
      if(pipes.length<2 || x - pipes[pipes.length-2].x > 150){
        pipes.push({x,y:0,w:40,h,passed:false,isTop:true});
        pipes.push({x,y:h+gap,w:40,h:canvas.height-h-gap,passed:false,isTop:false});
      }
    }

    // Main loop
    function loop(){
      if(state!=="playing") return;
      frameNo++;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      // background
      ctx.drawImage(bgImg,0,0,canvas.width,canvas.height);
      // spawn
      if(frameNo===1||frameNo%150===0) spawnPipes();
      // draw pipes
      pipes.forEach(p=>{
        p.x -= 2;
        ctx.drawImage(pipeImg,p.x,p.y,p.w,p.h);
      });
      pipes = pipes.filter(p=>p.x+p.w>0);
      // bird
      bird.update(); bird.draw();
      // scoring & collision
      pipes.forEach(p=>{
        if(p.isTop && !p.passed && bird.x > p.x+p.w){
          p.passed=true;
          score++;
          scoreDiv.textContent = score;
        }
        if(bird.collides(p)) endGame();
      });
      animId = requestAnimationFrame(loop);
    }

    // DOM elements
    const startBtn = document.getElementById("startBtn");
    const pauseBtn = document.getElementById("pauseBtn");
    const resumeBtn = document.getElementById("resumeBtn");
    const backFromPauseBtn = document.getElementById("backFromPauseBtn");
    const restartBtn = document.getElementById("restartBtn");
    const backFromGameOverBtn = document.getElementById("backFromGameOverBtn");
    const showLbBtn = document.getElementById("showLbBtn");
    const backFromLbBtn = document.getElementById("backFromLbBtn");
    const scoreDiv = document.getElementById("score");

    // Start game
    startBtn.onclick = ()=>{
      state="playing";
      hideAll();
      bird   = new Bird();
      pipes  = [];
      score  = 0;
      frameNo= 0;
      scoreDiv.textContent = score;
      pauseBtn.classList.remove("hidden");
      cancelAnimationFrame(animId);
      loop();
    };

    // Pause
    pauseBtn.onclick = ()=>{
      if(state==="playing"){
        state="paused";
        cancelAnimationFrame(animId);
        show("pause");
      }
    };
    resumeBtn.onclick = ()=>{
      if(state==="paused"){
        state="playing";
        hideAll();
        pauseBtn.classList.remove("hidden");
        cancelAnimationFrame(animId);
        loop();
      }
    };

    // Restart
    restartBtn.onclick = ()=>{
      state="playing";
      hideAll();
      bird   = new Bird();
      pipes  = [];
      score  = 0;
      frameNo= 0;
      scoreDiv.textContent = score;
      pauseBtn.classList.remove("hidden");
      cancelAnimationFrame(animId);
      loop();
    };

    // Main Menu (from Pause/Game Over)
    backFromPauseBtn.onclick = ()=>{
      cancelAnimationFrame(animId);
      state="menu";
      show("menu");
    };
    backFromGameOverBtn.onclick = ()=>{
      state="menu";
      show("menu");
    };

    // Game Over
    function endGame(){
      cancelAnimationFrame(animId);
      state="gameover";
      show("gameover");
      document.getElementById("finalScore").textContent = score;
      const name = prompt("Enter name:","Anon")||"Anon";
      db.push({name,score}).then(()=>{
        fetchAndRenderLB("#lb-list-go");
      });
    }

    // Leaderboard
    function fetchAndRenderLB(selector){
      const list = document.querySelector(selector);
      list.innerHTML = "";
      db.orderByChild("score").limitToLast(10).once("value",snap=>{
        const arr=[]; snap.forEach(c=>arr.push(c.val()));
        arr.sort((a,b)=>b.score-a.score);
        arr.forEach((e,i)=>{
          const d=document.createElement("div");
          d.textContent = `${i+1}. ${e.name}: ${e.score}`;
          list.appendChild(d);
        });
      });
    }
    showLbBtn.onclick = ()=>{
      state="leaderboard";
      hideAll();
      fetchAndRenderLB("#lb-list");
      show("leaderboard");
    };
    backFromLbBtn.onclick = ()=>{
      state="menu";
      show("menu");
    };

    // Controls
    window.addEventListener("keydown",e=>{
      if(e.code==="Space"&&state==="playing"){ bird.flap(); e.preventDefault(); }
      if(e.key==="k"&&state==="playing"){ pauseBtn.click(); }
    });
    window.addEventListener("touchstart",e=>{
      if(state==="playing"){ bird.flap(); e.preventDefault(); }
    });

    // Show initial menu
    show("menu");
  });
  </script>
</body>
</html>
