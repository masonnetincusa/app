<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Flappy Bird Minimal Test</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    html, body { margin:0; padding:0; width:100%; height:100%; background:#000; overflow:hidden; }
    #game-container { position:relative; width:100%; height:100%; }
    canvas { display:block; width:100%; height:100%; background:#000; }
    .overlay {
      position:absolute; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.75); color:#fff;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      font-family:Arial,sans-serif; text-align:center; z-index:10;
    }
    .hidden { display:none; }
    button {
      background:#e74c3c; border:none; color:#fff;
      padding:12px 24px; margin:8px; font-size:16px; cursor:pointer;
    }
    #score { position:absolute; top:10px; left:10px; color:#fff; font-size:24px; z-index:5; }
    #pauseBtn {
      position:absolute; top:10px; right:10px;
      background:#e74c3c; border:none; color:#fff;
      padding:8px 16px; font-size:14px; cursor:pointer; z-index:5;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <canvas id="canvas"></canvas>
    <div id="score">0</div>
    <button id="pauseBtn" class="hidden">Pause</button>

    <!-- Main Menu -->
    <div id="menu" class="overlay">
      <h1>Flappy Bird</h1>
      <button id="startBtn">Start</button>
      <button id="leaderboardBtn">Leaderboard</button>
    </div>

    <!-- Leaderboard -->
    <div id="leaderboard" class="overlay hidden">
      <h2>Top Scores</h2>
      <div id="lb-list">Empty</div>
      <button id="backFromLb">Back</button>
    </div>

    <!-- Pause Menu -->
    <div id="pause" class="overlay hidden">
      <h2>Paused</h2>
      <button id="resumeBtn">Resume</button>
      <button id="backFromPause">Main Menu</button>
    </div>

    <!-- Game Over -->
    <div id="gameover" class="overlay hidden">
      <h2>Game Over</h2>
      <p>Your Score: <span id="finalScore">0</span></p>
      <button id="restartBtn">Restart</button>
      <button id="backFromGameOver">Main Menu</button>
    </div>
  </div>

  <script>
    // Canvas setup
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // Game variables
    let bird, pipes, score, frame, loopId;
    let state = 'menu'; // menu, playing, paused, gameover, leaderboard

    // Bird class
    class Bird {
      constructor() {
        this.w = 30; this.h = 30;
        this.x = 50; this.y = canvas.height/2 - this.h/2;
        this.vy = 0; this.gravity = 0.3;
      }
      update() {
        this.vy += this.gravity;
        this.y += this.vy;
        if (this.y < 0) this.y = 0;
        if (this.y + this.h > canvas.height) this.y = canvas.height - this.h;
      }
      draw() {
        ctx.fillStyle = 'yellow';
        ctx.fillRect(this.x, this.y, this.w, this.h);
      }
      flap() {
        this.vy = -6;
      }
      collides(pipe) {
        return !(
          this.x + this.w < pipe.x ||
          this.x > pipe.x + pipe.w ||
          this.y + this.h < pipe.y ||
          this.y > pipe.y + pipe.h
        );
      }
    }

    // Spawn pipes
    function spawn() {
      const x = canvas.width;
      const h = 20 + Math.random() * (canvas.height/2 - 20);
      const gap = 120 + Math.random() * 80;
      pipes = pipes.filter(p => p.x + p.w > 0);
      if (pipes.length < 2 || x - pipes[pipes.length-2].x > 200) {
        pipes.push({ x, y:0, w:40, h, passed:false });
        pipes.push({ x, y:h+gap, w:40, h:canvas.height - h - gap, passed:false });
      }
    }

    // Main game loop
    function loop() {
      if (state !== 'playing') return;
      frame++;
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // Background (black)
      // Pipes
      if (frame === 1 || frame % 150 === 0) spawn();
      pipes.forEach(p => {
        p.x -= 2;
        ctx.fillStyle = 'green';
        ctx.fillRect(p.x, p.y, p.w, p.h);
      });

      // Remove offscreen
      pipes = pipes.filter(p => p.x + p.w > 0);

      // Bird physics & draw
      bird.update();
      bird.draw();

      // Score & collision
      pipes.forEach(p => {
        if (!p.passed && bird.x > p.x + p.w) {
          p.passed = true;
          score++;
          scoreDiv.textContent = score;
        }
        if (bird.collides(p)) {
          endGame();
        }
      });

      loopId = requestAnimationFrame(loop);
    }

    // DOM elements
    const startBtn = document.getElementById('startBtn');
    const leaderboardBtn = document.getElementById('leaderboardBtn');
    const backFromLb = document.getElementById('backFromLb');
    const pauseBtn = document.getElementById('pauseBtn');
    const resumeBtn = document.getElementById('resumeBtn');
    const backFromPause = document.getElementById('backFromPause');
    const restartBtn = document.getElementById('restartBtn');
    const backFromGameOver = document.getElementById('backFromGameOver');
    const scoreDiv = document.getElementById('score');
    const finalScore = document.getElementById('finalScore');

    // Show/hide overlays
    function hideAll() {
      ['menu','leaderboard','pause','gameover'].forEach(id =>
        document.getElementById(id).classList.add('hidden')
      );
      pauseBtn.classList.add('hidden');
    }
    function show(id) {
      hideAll();
      if (id) document.getElementById(id).classList.remove('hidden');
    }

    // Start Game
    startBtn.onclick = () => {
      state = 'playing';
      hideAll();
      bird = new Bird();
      pipes = [];
      score = 0;
      frame = 0;
      scoreDiv.textContent = score;
      pauseBtn.classList.remove('hidden');
      cancelAnimationFrame(loopId);
      loop();
    };

    // Leaderboard (static demo)
    leaderboardBtn.onclick = () => {
      state = 'leaderboard';
      show('leaderboard');
      document.getElementById('lb-list').textContent = 'No data in this demo';
    };
    backFromLb.onclick = () => show('menu');

    // Pause
    pauseBtn.onclick = () => {
      if (state === 'playing') {
        state = 'paused';
        cancelAnimationFrame(loopId);
        show('pause');
      }
    };
    resumeBtn.onclick = () => {
      if (state === 'paused') {
        state = 'playing';
        hideAll();
        pauseBtn.classList.remove('hidden');
        cancelAnimationFrame(loopId);
        loop();
      }
    };
    backFromPause.onclick = () => show('menu');

    // Game Over
    function endGame() {
      cancelAnimationFrame(loopId);
      state = 'gameover';
      finalScore.textContent = score;
      show('gameover');
    }
    restarting();
    restartBtn.onclick = () => {
      state = 'playing';
      hideAll();
      bird = new Bird();
      pipes = [];
      score = 0;
      frame = 0;
      scoreDiv.textContent = score;
      pauseBtn.classList.remove('hidden');
      cancelAnimationFrame(loopId);
      loop();
    };
    backFromGameOver.onclick = () => show('menu');

    // Controls
    window.addEventListener('keydown', e => {
      if (e.code === 'Space' && state === 'playing') {
        bird.flap(); e.preventDefault();
      }
      if (e.key === 'k' && state === 'playing') {
        pauseBtn.click();
      }
    });
    window.addEventListener('touchstart', e => {
      if (state === 'playing') {
        bird.flap(); e.preventDefault();
      }
    });

    // Initial menu
    show('menu');
  </script>
</body>
</html>
