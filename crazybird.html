<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flappy Bird â€“ Images + Firebase</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#000; color:#fff; }
    #game-container { position:relative; width:100%; height:100%; }
    canvas { display:block; width:100%; height:100%; }
    .overlay {
      position:absolute; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.8); display:flex; flex-direction:column;
      align-items:center; justify-content:center; text-align:center; z-index:10;
      font-family:Arial, sans-serif;
    }
    .hidden { display:none; }
    button {
      background:#e74c3c; border:none; color:#fff;
      padding:12px 24px; margin:8px; font-size:16px; cursor:pointer;
      touch-action: manipulation;
    }
    #score { position:absolute; top:10px; left:10px; font-size:24px; z-index:5; }
    #pauseBtn { position:absolute; top:10px; right:10px; display:none; z-index:5; }
    #lb-list, #lb-list-go {
      text-align:left; width:80%; max-height:150px; overflow-y:auto; margin:12px 0;
    }
    #lb-list div, #lb-list-go div { border-bottom:1px solid #444; padding:4px 0; }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-database-compat.js"></script>
</head>
<body>
  <div id="game-container">
    <canvas id="canvas"></canvas>
    <div id="score">0</div>
    <button id="pauseBtn">Pause</button>

    <!-- Main Menu -->
    <div id="menu" class="overlay">
      <h1>Flappy Bird</h1>
      <button id="startBtn">Start</button>
      <button id="leaderboardBtn">Leaderboard</button>
    </div>

    <!-- Leaderboard -->
    <div id="leaderboard" class="overlay hidden">
      <h2>Global Top 10</h2>
      <div id="lb-list"></div>
      <button id="backFromLbBtn">Back</button>
    </div>

    <!-- Pause Menu -->
    <div id="pause" class="overlay hidden">
      <h2>Paused</h2>
      <button id="resumeBtn">Resume</button>
      <button id="backFromPauseBtn">Main Menu</button>
    </div>

    <!-- Game Over -->
    <div id="gameover" class="overlay hidden">
      <h2>Game Over</h2>
      <p>Your Score: <span id="finalScore">0</span></p>
      <div id="lb-list-go"></div>
      <button id="restartBtn">Restart</button>
      <button id="backFromGameOverBtn">Main Menu</button>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // ----- CONFIGURE YOUR ASSETS & FIREBASE -----
    const BACKGROUND_URL = "YOUR_BACKGROUND_IMG_URL";
    const BIRD_IMG_URL   = "YOUR_BIRD_IMG_URL";
    const PIPE_IMG_URL   = "YOUR_PIPE_IMG_URL";
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DATABASE_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    // ---------------------------------------------

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref("leaderboard");

    // Canvas & UI elements
    const canvas   = document.getElementById("canvas");
    const ctx      = canvas.getContext("2d");
    const scoreDiv = document.getElementById("score");
    const pauseBtn = document.getElementById("pauseBtn");
    const finalScoreEl = document.getElementById("finalScore");

    // DOM overlays
    const overlays = {
      menu:       document.getElementById("menu"),
      leaderboard:document.getElementById("leaderboard"),
      pause:      document.getElementById("pause"),
      gameover:   document.getElementById("gameover")
    };

    // Preload images
    const bgImg   = new Image(); bgImg.src   = BACKGROUND_URL;
    const birdImg = new Image(); birdImg.src = BIRD_IMG_URL;
    const pipeImg = new Image(); pipeImg.src = PIPE_IMG_URL;

    // Game state
    let state   = "menu"; // menu, leaderboard, playing, paused, gameover
    let bird, pipes, score, frame, animId;

    // Resize canvas on window resize
    function resize() {
      canvas.width  = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resize);
    resize();

    // Bird class
    class Bird {
      constructor(){
        this.w  = 30; this.h = 30;
        this.x  = 50;
        this.y  = (canvas.height - this.h) / 2;
        this.vy = 0;  this.g = 0.3;
      }
      update(){
        this.vy += this.g;
        this.y  += this.vy;
        if(this.y < 0) this.y = 0;
        if(this.y + this.h > canvas.height) this.y = canvas.height - this.h;
      }
      draw(){
        ctx.drawImage(birdImg, this.x, this.y, this.w, this.h);
      }
      flap(){
        this.vy = -6;
      }
      collides(p){
        return !(
          this.x + this.w < p.x ||
          this.x > p.x + p.w ||
          this.y + this.h < p.y ||
          this.y > p.y + p.h
        );
      }
    }

    // Spawn pipes (tag only the top pipe for scoring)
    function spawnPipes(){
      const x   = canvas.width;
      const h   = 20 + Math.random() * (canvas.height/2 - 20);
      const gap = 120 + Math.random() * 80;
      pipes = pipes.filter(p => p.x + p.w > 0);
      if(pipes.length < 2 || x - pipes[pipes.length-2].x > 200) {
        pipes.push({ x, y:0,    w:40, h,                 passed:false, isTop:true  });
        pipes.push({ x, y:h+gap,w:40, h:canvas.height-h-gap, passed:false, isTop:false });
      }
    }

    // Main game loop
    function loop(){
      if(state !== "playing") return;
      frame++;
      // draw background
      ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);

      // spawn & draw pipes
      if(frame === 1 || frame % 150 === 0) spawnPipes();
      pipes.forEach(p => {
        p.x -= 2;
        ctx.drawImage(pipeImg, p.x, p.y, p.w, p.h);
      });
      pipes = pipes.filter(p => p.x + p.w > 0);

      // update & draw bird
      bird.update();
      bird.draw();

      // score & collisions
      pipes.forEach(p => {
        if(p.isTop && !p.passed && bird.x > p.x + p.w){
          p.passed = true;
          score++;
          scoreDiv.textContent = score;
        }
        if(bird.collides(p)) endGame();
      });

      animId = requestAnimationFrame(loop);
    }

    // Show/hide overlays
    function hideAll(){
      Object.values(overlays).forEach(el => el.classList.add("hidden"));
      pauseBtn.style.display = "none";
    }
    function show(id){
      hideAll();
      if(id === "playing"){
        pauseBtn.style.display = "block";
      } else if(id in overlays){
        overlays[id].classList.remove("hidden");
      }
    }

    // Fetch & render global top-10 from Firebase
    function fetchLeaderboard(target){
      const list = document.querySelector(target);
      list.innerHTML = "";
      db.orderByChild("score").limitToLast(10).once("value", snap => {
        const arr = [];
        snap.forEach(c => arr.push(c.val()));
        arr.sort((a,b) => b.score - a.score);
        arr.forEach((e,i) => {
          const d = document.createElement("div");
          d.textContent = `${i+1}. ${e.name}: ${e.score}`;
          list.appendChild(d);
        });
      });
    }

    // Game actions
    function startGame(){
      state  = "playing";
      bird   = new Bird();
      pipes  = [];
      score  = 0;
      frame  = 0;
      scoreDiv.textContent = score;
      show("playing");
      cancelAnimationFrame(animId);
      loop();
    }
    function showLeaderboard(){
      state = "leaderboard";
      fetchLeaderboard("#lb-list");
      show("leaderboard");
    }
    function pauseGame(){
      if(state !== "playing") return;
      state = "paused";
      cancelAnimationFrame(animId);
      show("pause");
    }
    function resumeGame(){
      if(state !== "paused") return;
      state = "playing";
      show("playing");
      cancelAnimationFrame(animId);
      loop();
    }
    function backToMenu(){
      state = "menu";
      show("menu");
    }
    function endGame(){
      cancelAnimationFrame(animId);
      state = "gameover";
      finalScoreEl.textContent = score;
      show("gameover");
      const name = prompt("Enter name for leaderboard","Anon")||"Anon";
      db.push({ name, score }).then(() => {
        fetchLeaderboard("#lb-list-go");
      });
    }
    function restartGame(){
      startGame();
    }

    // Utility: bind both click + touchend to support desktop & mobile
    function bind(id, fn){
      const el = document.getElementById(id);
      el.addEventListener("click", fn);
      el.addEventListener("touchend", e => { e.preventDefault(); fn(); });
    }

    // Wire up buttons
    bind("startBtn",           startGame);
    bind("leaderboardBtn",     showLeaderboard);
    bind("backFromLbBtn",      backToMenu);
    bind("pauseBtn",           pauseGame);
    bind("resumeBtn",          resumeGame);
    bind("backFromPauseBtn",   backToMenu);
    bind("restartBtn",         restartGame);
    bind("backFromGameOverBtn", backToMenu);

    // Keyboard/touch controls
    window.addEventListener("keydown", e => {
      if(e.code==="Space" && state==="playing") { bird.flap(); e.preventDefault(); }
      if(e.key==="k"     && state==="playing")   { pauseGame(); }
    });
    window.addEventListener("touchstart", e => {
      if(state==="playing") { bird.flap(); e.preventDefault(); }
    });

    // Show initial Main Menu
    show("menu");
  });
  </script>
</body>
</html>
