 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Flappy Bird with Firebase Leaderboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:Arial,sans-serif; background:#222; color:#fff; overflow-x:hidden; }
    h1 { text-align:center; margin:20px 0; }
    #game-container { position:relative; width:480px; height:270px; background:#000; margin:0 auto; overflow:hidden; }
    #canvas-container { width:100%; height:100%; }
    .overlay {
      position:absolute; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.85); display:flex; flex-direction:column;
      align-items:center; justify-content:center; z-index:100;
      text-align:center; padding:20px;
    }
    #main-menu { display:flex; }
    #game-over-screen, #leaderboard-menu, #pause-menu { display:none; }
    .menu-button {
      background:#f00; border:none; color:#fff;
      padding:12px 24px; margin:10px; border-radius:8px;
      font-size:16px; cursor:pointer;
    }
    #pauseButton {
      position:absolute; top:10px; right:10px;
      background:#f00; border:none; color:#fff;
      padding:8px 12px; border-radius:8px;
      font-size:14px; cursor:pointer; display:none;
    }
    #leaderboard-list { margin-top:15px; max-height:150px; overflow-y:auto; text-align:left; }
    #leaderboard-list div { padding:4px 0; border-bottom:1px solid #444; }
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-database-compat.js"></script>
</head>
<body>
  <h1>Flappy Bird Clone</h1>
  <div id="game-container">
    <div id="canvas-container"></div>
    <!-- Main Menu -->
    <div id="main-menu" class="overlay">
      <img src="https://app.masonnet.org/fbrc.png" alt="Title" style="max-width:80%; margin-bottom:10px;">
      <p>Version 2.0, Build 0014</p>
      <p id="high-score-display">High Score: 0</p>
      <button class="menu-button" onclick="startGameFromMenu()">Start</button>
      <button class="menu-button extra-button" onclick="showLeaderboard()">Leaderboard</button>
      <button class="menu-button extra-button" onclick="toggleSound()">Sound: On</button>
      <div class="extra-button" id="fs-button-container">
        <button class="menu-button" onclick="toggleFullScreen()">Full Screen</button>
      </div>
    </div>
    <!-- Pause -->
    <div id="pause-menu" class="overlay">
      <h2>Paused</h2>
      <button class="menu-button" onclick="togglePause()">Resume</button>
      <button class="menu-button" onclick="backToMainMenu()">Main Menu</button>
    </div>
    <!-- Game Over with inline leaderboard -->
    <div id="game-over-screen" class="overlay">
      <h2>Game Over</h2>
      <p>Your Score: <span id="final-score">0</span></p>
      <div id="leaderboard-list"></div>
      <button class="menu-button" onclick="restartGame()">Restart</button>
      <button class="menu-button" onclick="backToMainMenu()">Main Menu</button>
    </div>
    <!-- Leaderboard Overlay -->
    <div id="leaderboard-menu" class="overlay">
      <h2>Top 10 Global Scores</h2>
      <div id="leaderboard-list"></div>
      <button class="menu-button" onclick="showMainMenu()">Back</button>
    </div>
    <!-- Pause Button -->
    <button id="pauseButton" onclick="togglePause()">Pause</button>
  </div>
  <script>
    // FIREBASE SETUP (replace placeholders)
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyA4YGz73C13yVjqqMzpM2oJHHqJebYwnOU",
  authDomain: "masonnet-app.firebaseapp.com",
  databaseURL: "https://masonnet-app-default-rtdb.firebaseio.com",
  projectId: "masonnet-app",
  storageBucket: "masonnet-app.firebasestorage.app",
  messagingSenderId: "245878148284",
  appId: "1:245878148284:web:2b3f54cebc08ad14b594b9",
  measurementId: "G-NY1MN2R295"
};
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // GLOBALS
    let gameState = "menu", gameLoop, canvas, ctx;
    let frameNo = 0, obstacles = [], score = 0, player, paused = false;
    let soundOn = true, sound = new Audio("https://example.com/sound.mp3"); // replace

    // PLAYER CLASS
    function Component(w,h,cx,cy){
      this.width=w; this.height=h;
      this.x=cx; this.y=cy;
      this.gravity=0.1; this.gravitySpeed=0;
      this.update = () => {
        ctx.fillStyle = c; ctx.fillRect(this.x,this.y,w,h);
      };
      this.newPos = () => {
        this.gravitySpeed += this.gravity;
        this.y += this.gravitySpeed;
        if(this.y+this.height>=canvas.height){
          clearInterval(gameLoop);
          gameOver();
        }
      };
      this.crashWith = (obs) => {
        return !(this.x+this.width<obs.x ||
                 this.x>obs.x+obs.width ||
                 this.y+this.height<obs.y ||
                 this.y>obs.y+obs.height);
      };
    }

    // INITIALIZE
    window.onload = () => {
      loadLeaderboard();
      showMainMenu();
    };

    // LOAD LEADERBOARD from localStorage
    let leaderboard = [];
    function loadLeaderboard(){
      const data = localStorage.getItem("flappyLB");
      leaderboard = data ? JSON.parse(data) : [];
    }
    function saveLeaderboard(){
      localStorage.setItem("flappyLB", JSON.stringify(leaderboard));
    }

    // UI FUNCTIONS
    function hideAll(){
      ["main-menu","leaderboard-menu","pause-menu","game-over-screen"]
        .forEach(id=>document.getElementById(id).style.display="none");
      document.getElementById("pauseButton").style.display="none";
    }
    function showMainMenu(){
      gameState="menu"; hideAll();
      document.getElementById("main-menu").style.display="flex";
      updateHighScoreDisplay();
    }
    function showLeaderboard(){
      gameState="leaderboard"; hideAll();
      document.getElementById("leaderboard-menu").style.display="flex";
      renderLeaderboard();
    }
    function updateHighScoreDisplay(){
      const high = leaderboard.length?leaderboard[0].score:0;
      document.getElementById("high-score-display").innerText = "High Score: "+high;
    }
    function renderLeaderboard(){
      const div = document.getElementById("leaderboard-list");
      div.innerHTML="";
      leaderboard.forEach((e,i)=>{
        const row = document.createElement("div");
        row.innerText = `${i+1}. ${e.name}: ${e.score}`;
        div.appendChild(row);
      });
    }

    // START/GAME FUNCTIONS
    function startGameFromMenu(){
      if(!document.fullscreenElement){
        if(confirm("Full screen?")) toggleFullScreen();
        return;
      }
      startGame();
    }
    function startGame(){
      gameState="playing"; hideAll();
      // reset
      frameNo=0; obstacles=[]; score=0;
      document.getElementById("pauseButton").style.display="block";
      // canvas
      const container = document.getElementById("canvas-container");
      container.innerHTML="";
      canvas = document.createElement("canvas");
      canvas.width = document.fullscreenElement?window.innerWidth:480;
      canvas.height = document.fullscreenElement?window.innerHeight:270;
      ctx = canvas.getContext("2d");
      container.appendChild(canvas);
      // player
      player = new Component(30,30, "blue", 10,120);
      // loop
      clearInterval(gameLoop);
      gameLoop = setInterval(updateGameArea,20);
    }

    function gameOver(){
      gameState="gameover";
      updateLeaderboard();
      clearInterval(gameLoop);
      document.getElementById("final-score").innerText = score;
      showGameOverOverlay();
    }
    function restartGame(){
      hideAll(); startGame();
    }
    function backToMainMenu(){
      clearInterval(gameLoop); showMainMenu();
    }

    function updateGameArea(){
      // floor
      if(player.y+player.height>=canvas.height){
        clearInterval(gameLoop); return gameOver();
      }
      // collisions
      for(let obs of obstacles){
        if(player.crashWith(obs)){
          clearInterval(gameLoop); return gameOver();
        }
      }
      // draw
      ctx.clearRect(0,0,canvas.width,canvas.height);
      frameNo++;
      // spawn obstacles
      if(frameNo===1 || frameNo%150===0){
        const x=canvas.width;
        const minH=20,maxH=200;
        const h=Math.floor(Math.random()*(maxH-minH)+minH);
        const minGap=80,maxGap=200;
        const gap = Math.floor(Math.random()*(maxGap-minGap)+minGap);
        // remove offscreen
        obstacles=obstacles.filter(o=>o.x+o.width>0);
        // avoid overlap
        if(obstacles.length<2 || x - obstacles[obstacles.length-2].x >= 80){
          obstacles.push({x,y:0,width:40,height:h,passed:false});
          obstacles.push({x,y:h+gap,width:40,height:canvas.height-h-gap,passed:false});
        }
      }
      // move+draw obstacles
      for(let obs of obstacles){
        obs.x-=2;
        ctx.fillStyle="green";
        ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
      }
      // score
      for(let i=0;i<obstacles.length;i+=2){
        if(!obstacles[i].passed && player.x>obstacles[i].x+obstacles[i].width){
          obstacles[i].passed=true; score++;
        }
      }
      ctx.fillStyle="black";
      ctx.font="30px Arial";
      ctx.fillText(score,canvas.width-60,40);
      // player
      player.newPos(); player.update();
    }

    // PAUSE
    function togglePause(){
      if(gameState==="playing"){
        clearInterval(gameLoop);
        gameState="paused";
        hideAll();
        document.getElementById("pause-menu").style.display="flex";
      } else if(gameState==="paused"){
        document.getElementById("pause-menu").style.display="none";
        gameState="playing";
        gameLoop=setInterval(updateGameArea,20);
      }
    }

    // FULLSCREEN
    function toggleFullScreen(){
      const e=document.getElementById("game-container");
      if(!document.fullscreenElement) e.requestFullscreen?.();
      else document.exitFullscreen?.();
    }

    // SOUND
    function toggleSound(){
      soundOn = !soundOn;
      sound.muted = !soundOn;
      document.getElementById("soundButton").innerText = "Sound: "+(soundOn?"On":"Off");
    }

    function accelerate(n){
      player.gravity = n;
    }

    window.addEventListener("keydown",e=>{
      if(e.code==="Space"){ accelerate(-0.5); e.preventDefault(); }
      if(e.key==="k"){ togglePause(); e.preventDefault(); }
    });
    window.addEventListener("keyup",e=>{
      if(e.code==="Space"){ accelerate(0.1); e.preventDefault(); }
    });

    // LEADERBOARD (localStorage)
    function updateLeaderboard(){
      const name = prompt("High Score! Enter name:")||"Anon";
      leaderboard.push({name,score});
      leaderboard.sort((a,b)=>b.score-a.score);
      leaderboard = leaderboard.slice(0,10);
      saveLeaderboard();
    }
    function saveLeaderboard(){
      localStorage.setItem("flappyLB",JSON.stringify(leaderboard));
    }
    function showGameOverOverlay(){
      hideAll();
      document.getElementById("game-over-screen").style.display="flex";
      renderLeaderboard();
    }
  </script>
</body>
</html>
